#@gmic
#
#  File        : david_tschumperle.gmic
#                ( G'MIC commands file )
#
#  Description : Personal G'MIC filters done by Ronounours and others.
#
#  Copyright   : David Tschumperle
#                ( http://tschumperle.users.greyc.fr/ )
#
#  License     : CeCILL v2.0
#                ( http://www.cecill.info/licences/Licence_CeCILL_V2-en.html )
#
#  This software is governed by the CeCILL  license under French law and
#  abiding by the rules of distribution of free software.  You can  use,
#  modify and/ or redistribute the software under the terms of the CeCILL
#  license as circulated by CEA, CNRS and INRIA at the following URL
#  "http://www.cecill.info".
#
#  As a counterpart to the access to the source code and  rights to copy,
#  modify and redistribute granted by the license, users are provided only
#  with a limited warranty  and the software's author,  the holder of the
#  economic rights,  and the successive licensors  have only  limited
#  liability.
#
#  In this respect, the user's attention is drawn to the risks associated
#  with loading,  using,  modifying and/or developing or reproducing the
#  software by the user in light of its specific status of free software,
#  that may mean  that it is complicated to manipulate,  and  that  also
#  therefore means  that it is reserved for developers  and  experienced
#  professionals having in-depth computer knowledge. Users are therefore
#  encouraged to load and test the software's suitability as regards their
#  requirements in conditions enabling the security of their systems and/or
#  data to be ensured and,  more generally, to use and operate it in the
#  same conditions as regards security.
#
#  The fact that you are presently reading this means that you have had
#  knowledge of the CeCILL license and that you accept its terms.
#

#@gui _<b>Artistic</b>
#---------------------

#@gui Illustration Look : fx_illustration_look,fx_illustration_look_preview(0)
#@gui : Tone Mapping (%) = float(100,0,100)
#@gui : Desaturate (%) = float(0,0,100)
#@gui : Vintage Tone (%) = float(0,0,100)
#@gui : Output as Multiple Layers = bool(0)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Authors: <i>S&#233;bastien Guyader</i> and <i>David Tschumperl&#233;</i>.      Latest update: <i>2017/05/01</i>.</small>")
fx_illustration_look :
  repeat $! l[$>] nm=${-gui_layer_name}
    to_rgb nm. base_layer

    # Create processed layers.
    +fx_smooth_anisotropic[base_layer] 20,0.16,0.63,0.6,2.35,0.8,30,2,0,1,1,0,1,24 nm. blur_layer
    +blend[base_layer,blur_layer] grainextract nm. detail_layer
    if $2 rgb2hsv[blur_layer] sh[blur_layer] 1 -. {$2%} c. 0,1 rm. hsv2rgb[blur_layer] fi
    if $3 +fx_mix_rgb[blur_layer] 1,10,0,1,0,0,0.7,-10,0,0,10,0 j[blur_layer] .,0,0,0,0,{$3%} rm. fi
    if $1 +fx_map_tones_fast[blur_layer] 20,0.2,11,0 j[blur_layer] .,0,0,0,0,{$1%} rm. fi
    simplelocalcontrast_p[blur_layer] 25,1,50,1,1,1,1,1,1,1,1,1
    +fx_graphic_novelfxl[blur_layer] 1,2,6,5,20,0,1.02857,200,0,1,0.0761905,0.0857143,0,0,0,2,1,1,1,1.25714,0.371429,1.04762 nm. graphicnovel_layer

    # Order and set layer properties.
    mv[detail_layer] 0 nm[detail_layer] "name("$nm" [Detail]),mode(grainmerge),opacity(100)"
    mv[graphicnovel_layer] 1 nm[graphicnovel_layer] "name("$nm" [Paint]),mode(normal),opacity(50)"
    mv[blur_layer] 2 nm[blur_layer] "name("$nm" [Base]),mode(normal),opacity(100)"
    rm[base_layer]

    if !$4 gui_merge_layers nm "name("$nm"),mode(normal),opacity(100)" fi
  endl done

fx_illustration_look_preview :
  gui_split_preview "fx_illustration_look ${1-3},0",$-1


#@gui _<b>Colors</b>
#---------------------

# Color Grading v1.5.3
# Copyright (c) 2012-2014 John Lakkas
# john_lakkas@yahoo.gr
# Licence: GNU GPLv3  ( http://www.gnu.org/licenses/ )

# Convert HSV to RGB triplets.
jl_hsv_to_rgb :
  ({360*$1}^$2^$3) hsv2rgb. u {^} rm.

# LEVELS input low-high gamma output low/high
levels :
  _inplow={int($1)}
  _inphigh={int($2)}
  _gamma=$3
  _outlow={int($4)}
  _outhigh={int($5)}
  _tmp2=""

  if $_gamma!=1
    _tmp2="-apply_gamma "$_gamma
    apply_channels $_tmp2,$6,0
  fi

  _curve1="0,"
  if $_inplow>0
    _tmp1="0,"
    _curve1=$_curve1$_tmp1$_outlow","
  fi
  _curve1=$_curve1$_inplow","$_outlow","$_inphigh","$_outhigh
  if $_inphigh<255
    _curve1=$_curve1",255,"$_outhigh
  fi

  if ['$_curve1']!='0,0,0,255,255'
    _tmp2="-apply_curve "$_curve1
    apply_channels $_tmp2,$6,0
  fi

fx_equalize_s :
  repeat $! l[$>] split_opacity l[0] to_rgb
     rgb2hsv sh 1,1 *. $1 +. $2 c. 0,1 rm. hsv2rgb
  endl a c endl done

#@gui Color Grading : jl_colorgrading, jl_colorgrading_preview(1)
#@gui : note = note("A filter for basic photo editing and color grading.")
#@gui : note = note("<small><b>Note:</b> Saturation channel gamma affects more the less saturated areas. S-curve contrast, affects shadows and highlights equally. When using noise reduction or sharpening tools, zoom in for more accurate view.</small>")
#@gui : sep = separator()
#@gui : HDR Effect (Tone Map) = float(0.,0.0,1)
#@gui : Cool / Warm = int(0,-50,50)
#@gui : Saturation = float(1,0,2)
#@gui : Saturation Channel Gamma = float(1,0.1,3)
#@gui : note = note("<small><b>Note:</b> Saturation channel gamma may introduce artifacts depending on the image.</small>")
#@gui : sep = separator()
#@gui : S-Curve Contrast = int(0,-30,30)
#@gui : Shadows = int(0,-50,50)
#@gui : Highlights = int(0,-50,50)
#@gui : Blacks = int(0,0,50)
#@gui : Brightness = int(0,-50,50)
#@gui : Contrast = int(0,-50,50)
#@gui : Gamma = float(1,0.1,3)
#@gui : sep = separator()
#@gui : Clarity = float(0,0.0,2.0)
#@gui : Local Contrast Enhance = float(0,0,3)
#@gui : sep = separator()
#@gui : Color Grading = bool(0)
#@gui : Highlights Color Intensity = int(70,0,130)
#@gui : Highlights Hue = int(0,0,360)
#@gui : Highlights Brightness = int(0,-100,100)
#@gui : Midtones Color Intensity = int(0,0,130)
#@gui : Midtones Hue = int(0,0,360)
#@gui : Midtones Brightness = int(0,-100,100)
#@gui : Shadows Color Intensity = int(70,0,130)
#@gui : Shadows Hue Shift = int(180,0,360)
#@gui : Shadows Brightness = int(0,-100,100)
#@gui : note = note("<small><b>Color grading subsection usage:</b> Use intensity sliders to control the amount of color being applied in the highlights/midtones/shadows, use brightness sliders for bringing up or down highlights/midtones/shadows. Hues here follow rotation axis in color wheel ie: 0 or 360 deg is red, 180 is blue it's complimentary. Shadows hue shift in default position uses always the complimentary color of highlights in the shadows. Default sliders for grading apply red highlights and blue shadows effect.</small>")
#@gui : sep = separator()
#@gui : Output Saturation = float(1,0,2)
#@gui : Output Sharpening = float(0,0,10)
#@gui : Output Chroma NR = float(0,0,20)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>John Lakkas</i>.      Latest update: <i>17/03/2015</i>.</small>")
jl_colorgrading :
  if $1>0.01
    map_tones_fast 5%,$1
  fi
  _ystr=""
  # COLOR MANIPULATION
  # COOL / WARM filter
  if $2>0
  _mymin={$2}
  _mymax={255-$2}
  apply_channels "-apply_curve 0,0,$_mymin,255,255",ycbcr_cr,0
  apply_channels "-apply_curve 0,0,0,255,$_mymax",ycbcr_cb,0
  fi
  if $2<0
  _mymin={-$2}
  _mymax={255+$2}
  apply_channels "-apply_curve 0,0,$_mymin,255,255",ycbcr_cb,0
  apply_channels "-apply_curve 0,0,0,255,$_mymax",ycbcr_cr,0
  fi
  # HSV SATURATION (linear)
  if $3!=1.0
    fx_equalize_s $3,0
  fi
  # HSV SATURATION (gamma)
  if $4!=1.0
  apply_channels "-apply_gamma $4",hsv_s,0
  fi
  # VALUE MANIPULATION
  # S CURVE
  if $5!=0
  _p1={64-$5}
  _p2={192+$5}
  _ystr=$_ystr" apply_curve 1,0,0,64,$_p1,192,$_p2,255,255"
  fi
  # SHADOWS
  if $6!=0
  _p3={64-$6}
  _ystr=$_ystr" apply_curve 1,0,0,64,$_p3,128,128,192,192,255,255"
  fi
  # HIGHLIGHTS
  if $7!=0
  _p4={192+$7}
  _ystr=$_ystr" apply_curve 1,0,0,64,64,128,128,192,$_p4,255,255"
  fi
  # BLACKS
  if $8>0
  _ystr=$_ystr" apply_curve 1,$8,0,64,64,255,255"
  fi
  # BRIGHTNESS
  if $9>0
  _p5=0
  _ystr=$_ystr" apply_curve 0,0,$9,255,255"
  fi
  if $9<0
  _p5={255+$9}
  _ystr=$_ystr" apply_curve 0,0,0,255,$_p5"
  fi
  # CONTRAST
  if $10>0
  _p6=$10
  _p7={255-$10}
  _ystr=$_ystr" apply_curve 0,0,0,$_p6,0,$_p7,255,255,255"
  fi
  if $10<0
  _p6={-$10}
  _p7={255+$10}
  _ystr=$_ystr" apply_curve 0,0,$_p6,255,$_p7"
  fi
  # GAMMA
  if $11!=1.0
  _ystr=$_ystr" apply_gamma $11"
  fi
  # APPLY VALUE PROCESSING
  if '$_ystr'!=0
  apply_channels $_ystr,hsv_v,0
  fi
  # CLARITY (midtones unsharp mask)
  if $12>0
  to_rgb +rgb2hsl s. c rm.. rm.. *. 255 apply_curve. 1,0,0,63,0,127,255,192,0,255,0 +unsharp[0] 5%,$12,0 c. 0,255 c.. 0,255 rv[-1,-2] a[-1,-2] c blend alpha
  fi
   # LOCAL CONTRAST (unsharp mask)
  if $13>0
  unsharp 1%,$13,0
  c. 0,255
  fi
  # COLOR GRADING STEP
  if $14
    if $16+$22>360
      _shh={($16+$22-360)/360}
    else
      _shh={($16+$22)/360}
    fi
    _shs={$21/100}
    _shlev={$23}
    _midh={$19/360}
    _mids={$18/100}
    _midlev={$20}
    _highh={$16/360}
    _highs={$15/100}
    _highlev={$17}
    _satlev={$24}
    color_grade $_shh,$_shs,$_shlev,$_midh,$_mids,$_midlev,$_highh,$_highs,$_highlev,$_satlev
  fi
  # HSV SATURATION (linear)
  if $24!=1.0
    fx_equalize_s $24,0
  fi
  # USM
  if $25>0
    unsharp 0.5,$25
    c 0,255
  fi
  # CHROMA NR
  if $26>0
    apply_channels "-denoise_haar $26",ycbcr_cb,0
    apply_channels "-denoise_haar $26",ycbcr_cr,0
  fi

color_grade :
#convert_to_levels :
      # input:
      # shh, shs, shlev, midh, mids, midlev, highh, highs, highlev, satlev

      _shadownrgb=${-jl_hsv_to_rgb" "$1,1.0,{$2*0.40}}
      _midtonesrgb=${-jl_hsv_to_rgb" "$4,1.0,{$5*0.40}}
      _highlightsrgb=${-jl_hsv_to_rgb" "$7,1.0,{$8*0.40}}

      # make:
      # crsh, mgsh, ybsh, shlev, crmid, mgmid, ybmid, midlev, crhigh, mghigh, ybhigh, highlev, satlev

      _crsh=${-arg" 1,"$_shadownrgb}
      _mgsh=${-arg" 2,"$_shadownrgb}
      _ybsh=${-arg" 3,"$_shadownrgb}
      _shlev=$3

      _crmid=${-arg" 1,"$_midtonesrgb}
      _mgmid=${-arg" 2,"$_midtonesrgb}
      _ybmid=${-arg" 3,"$_midtonesrgb}
      _midlev=$6

      _crhigh=${-arg" 1,"$_highlightsrgb}
      _mghigh=${-arg" 2,"$_highlightsrgb}
      _ybhigh=${-arg" 3,"$_highlightsrgb}
      _highlev=$9

      _satlev=$10
      _lowinred=0
      _hiinred=255
      _lowingreen=0
      _hiingreen=255
      _lowinblue=0
      _hiinblue=255

      _gammared=0.
      _gammagreen=0.
      _gammablue=0.

      _lowoutred=0
      _hioutred=255
      _lowoutgreen=0
      _hioutgreen=255
      _lowoutblue=0
      _hioutblue=255

      #MIDTONES
      if $_crmid>0
         _gammared={$_gammared+0.4*$_crmid/100.}
         _gammagreen={$_gammagreen-0.3*$_crmid/100.}
         _gammablue={$_gammablue-0.3*$_crmid/100.}
      fi
      if $_crmid<0
         _gammared={$_gammared+0.3*$_crmid/100.}
         _gammagreen={$_gammagreen-0.4*$_crmid/100.}
         _gammablue={$_gammablue-0.4*$_crmid/100.}
      fi
      if $_mgmid>0
         _gammared={$_gammared-0.3*$_mgmid/100.}
         _gammagreen={$_gammagreen+0.4*$_mgmid/100.}
         _gammablue={$_gammablue-0.3*$_mgmid/100.}
      fi
      if $_mgmid<0
         _gammared={$_gammared-0.4*$_mgmid/100.}
         _gammagreen={$_gammagreen+0.3*$_mgmid/100.}
         _gammablue={$_gammablue-0.4*$_mgmid/100.}
      fi
      if $_ybmid>0
         _gammared={$_gammared-0.3*$_ybmid/100.}
         _gammagreen={$_gammagreen-0.3*$_ybmid/100.}
         _gammablue={$_gammablue+0.4*$_ybmid/100.}
      fi
      if $_ybmid<0
         _gammared={$_gammared-0.4*$_ybmid/100.}
         _gammagreen={$_gammagreen-0.4*$_ybmid/100.}
         _gammablue={$_gammablue+0.3*$_ybmid/100.}
      fi
      _gammared={$_gammared+1.}
      _gammagreen={$_gammagreen+1.}
      _gammablue={$_gammablue+1.}

      if $_midlev>0
         _gammared={$_gammared+0.4*$_midlev/100.}
         _gammagreen={$_gammagreen+0.4*$_midlev/100.}
         _gammablue={$_gammablue+0.4*$_midlev/100.}
      fi
      if $_midlev<0
         _gammared={$_gammared+0.3*$_midlev/100.}
         _gammagreen={$_gammagreen+0.3*$_midlev/100.}
         _gammablue={$_gammablue+0.3*$_midlev/100.}
      fi


      #SHADOWS
      _crsh={$_crsh*0.3}
      _mgsh={$_mgsh*0.3}
      _ybsh={$_ybsh*0.3}

      if $_crsh>0
         _lowingreen={$_lowingreen+$_crsh}
         _lowinblue={$_lowinblue+$_crsh}
         _lowoutred={$_lowoutred+$_crsh}
      else
         _lowinred={$_lowinred-$_crsh}
         _lowoutgreen={$_lowoutgreen-$_crsh}
         _lowoutblue={$_lowoutblue-$_crsh}
      fi

      if $_mgsh>0
         _lowinred={$_lowinred+$_mgsh}
         _lowinblue={$_lowinblue+$_mgsh}
         _lowoutgreen={$_lowoutgreen+$_mgsh}
      else
         _lowingreen={$_lowingreen-$_mgsh}
         _lowoutred={$_lowoutred-$_mgsh}
         _lowoutblue={$_lowoutblue-$_mgsh}
      fi

      if $_ybsh>0
         _lowinred={$_lowinred+$_ybsh}
         _lowingreen={$_lowingreen+$_ybsh}
         _lowoutblue={$_lowoutblue+$_ybsh}
      else
         _lowinblue={$_lowinblue-$_ybsh}
         _lowoutred={$_lowoutred-$_ybsh}
         _lowoutgreen={$_lowoutgreen-$_ybsh}
      fi


      if $_shlev>0
         _lowoutred={$_lowoutred+$_shlev}
         _lowoutgreen={$_lowoutgreen+$_shlev}
         _lowoutblue={$_lowoutblue+$_shlev}
      fi
      if $_shlev<0
         _lowinred={$_lowinred-$_shlev}
         _lowingreen={$_lowingreen-$_shlev}
         _lowinblue={$_lowinblue-$_shlev}
      fi


      #HIGHLIGHTS
      _crhigh={$_crhigh*0.3}
      _mghigh={$_mghigh*0.3}
      _ybhigh={$_ybhigh*0.3}

      if $_crhigh>0
         _hiinred={$_hiinred-$_crhigh}
         _hioutgreen={$_hioutgreen-$_crhigh}
         _hioutblue={$_hioutgreen-$_crhigh}
      else
         _hiingreen={$_hiingreen+$_crhigh}
         _hiinblue={$_hiinblue+$_crhigh}
         _hioutred={$_hioutred+$_crhigh}
      fi

      if $_mghigh>0
         _hiingreen={$_hiingreen-$_mghigh}
         _hioutred={$_hioutred-$_mghigh}
         _hioutblue={$_hioutblue-$_mghigh}
      else
         _hiinred={$_hiinred+$_mghigh}
         _hiinblue={$_hiinblue+$_mghigh}
         _hioutgreen={$_hioutgreen+$_mghigh}
      fi

      if $_ybhigh>0
         _hiinblue={$_hiinblue-$_ybhigh}
         _hioutred={$_hioutred-$_ybhigh}
         _hioutgreen={$_hioutgreen-$_ybhigh}
      else
         _hiinred={$_hiinred+$_ybhigh}
         _hiingreen={$_hiingreen+$_ybhigh}
         _hioutblue={$_hioutblue+$_ybhigh}
      fi

      if $_highlev>0
         _hiinred={$_hiinred-$_highlev}
         _hiingreen={$_hiingreen-$_highlev}
         _hiinblue={$_hiinblue-$_highlev}
      fi
      if $_highlev<0
         _hioutred={$_hioutred+$_highlev}
         _hioutgreen={$_hioutgreen+$_highlev}
         _hioutblue={$_hioutblue+$_highlev}
      fi

      levels $_lowinred,$_hiinred,$_gammared,$_lowoutred,$_hioutred,19
      levels $_lowingreen,$_hiingreen,$_gammagreen,$_lowoutgreen,$_hioutgreen,20
      levels $_lowinblue,$_hiinblue,$_gammablue,$_lowoutblue,$_hioutblue,21

jl_colorgrading_preview :
  gui_split_preview "-jl_colorgrading $*",$-1

#@gui _<b>Testing</b>
#---------------------

#@gui <i>Reptorian</i>
#@gui Modulos Operations : fx_modulo, fx_modulo_preview(0)
#@gui : note = note("This filters applies modulo operation after arithmetic operation. Future version of this filter might be able to be used on different color space and channels.")
#@gui : sep = separator()
#@gui : Multiply = float(1,0,32)
#@gui : Addition = int(0,0,255)
#@gui : sep = separator(), note = note("<small>Author : <i>Reptorian</i>.      Latest update : <i>2018/08/18</i>.</small>")
fx_modulo:
  repeat $! l[$>] split_opacity l[0]
    mul $1 add $2 mod 256
  endl a c endl done

fx_modulo_preview :
  gui_split_preview "fx_modulo $*"

#@gui _<i>Chris From Pixls.Us</i>

#@gui Remove Scratches : fx_remove_scratches, fx_remove_scratches_preview(0)
#@gui : note = note("<small><b>Note:</b> Scratch removal for scanned film images</small>")
#@gui : sep = separator()
#@gui : Threshold = float(72,0,100)
#@gui : Erosion = int(2,0,5)
#@gui : Dilation = int(4,0,7)
#@gui : Show Preview After = choice(3,"Threshold","Erosion","Dilation","Final image")
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>Chris/Pixls.us</i>.      Latest update: <i>2017/04/01</i>.</small>")
_fx_remove_scratches :
  repeat $! l[$>] to_rgba
    sh 0,2
    sh.. 3
    <. {$1*255%}
    if $4>=1 erode. $2 fi
    if $4>=2 dilate. $3 fi
    if $4<3 k... channels 3 * 255
    else inpaint_matchpatch.. . k... channels 0,2
    fi
  endl done

fx_remove_scratches :
  _fx_remove_scratches ${1-3},3

fx_remove_scratches_preview :
  gui_split_preview "_fx_remove_scratches $*",$-1


##########################################################

#@gui _<i>Deprecated</i>

#@gui Morphological Filter (Deprecated) : fx_morpho, fx_morpho_preview(0)
#@gui : Action = choice("Erosion","Dilation","Opening","Closing",
#@gui : "Original - Erosion","Dilation - Original","Original - Opening","Closing - Original")
#@gui : Size = int(5,2,60)
#@gui : Negative = bool()
#@gui : Shape = choice(0,"Square","Octagonal","Circular")
#@gui : sep = separator(), Channel(s) = choice("All","RGBA [all]","RGB [all]","RGB [red]","RGB [green]","RGB [blue]","RGBA [alpha]","Linear RGB [all]","Linear RGB [red]","Linear RGB [green]","Linear RGB [blue]","YCbCr [luminance]","YCbCr [blue-red chrominances]","YCbCr [blue chrominance]","YCbCr [red chrominance]","YCbCr [green chrominance]","Lab [lightness]","Lab [ab-chrominances]","Lab [a-chrominance]","Lab [b-chrominance]","Lch [ch-chrominances]","Lch [c-chrominance]","Lch [h-chrominance]","HSV [hue]","HSV [saturation]","HSV [value]","HSI [intensity]","HSL [lightness]","CMYK [cyan]","CMYK [magenta]","CMYK [yellow]","CMYK [key]","YIQ [luma]","YIQ [chromas]")
#@gui : Value Action = choice("None","Cut","Stretch")
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2014/06/08</i>.</small>")
fx_morpho :
  ac "-__fx_morpho ${^0}",$5,$6

fx_morpho_preview :
  gui_split_preview "fx_morpho ${^0}",$-1

__fx_morpho :
  if $4==1 suf="_oct" elif $4==0 suf="" else suf="_circ" fi
  if $1==0 erode$suf $2
  elif $1==1 dilate$suf $2
  elif $1==2 erode$suf $2 dilate$suf $2
  elif $1==3 dilate$suf $2 erode$suf $2
  elif $1==4 repeat $! +erode$suf $2 -[-2,-1] mv. 0 done
  elif $1==5 repeat $! +dilate$suf $2 rv[-2,-1] -[-2,-1] mv. 0 done
  elif $1==6 repeat $! +erode$suf $2 dilate$suf. $2 -[-2,-1] mv. 0 done
  else repeat $! +dilate$suf $2 erode$suf. $2 rv[-2,-1] -[-2,-1] mv. 0 done
  fi
  if $3 repeat $! l[$>] split_opacity negate[0] a c endl done fi

##########################################################

#@gui _<i>Corvo</i>

#@gui Corvo's Painting_5 : fx_corvo_painting_5, fx_corvo_painting_5(0)
#@gui : note = note("Polygonize settings")
#@gui : Amplitude = int(35,0,2000)
#@gui : Smoothness = float(10,0,100)
#@gui : Minimal Area = float(10,0,100)
#@gui : Alpha Polygonize = float(0.5,0,1)
#@gui : sep = separator()
#@gui : Texture = float(50,0,100)
#@gui : Plasma = float(0.3,0,1)
#@gui : sep = separator()
#@gui : note = note("Smooth settings")
#@gui : Amplitude = float(50,0,1000)
#@gui : Gradient Smoothness = float(2,0,10)
#@gui : Tensor Smoothness = float(5,0,10)
#@gui : Alpha Filter= float(1,0,1)
fx_corvo_painting_5 :
--polygonize $1,$2,$3,10,10
--blend[0,1] alpha,$4
-texturize_canvas[2] $5,0.5,0.6
-smooth[2] $7,0.4,0.7,$8,$9
--plasma[2] 0.7,100,8 n 0,255
-blend[3,2] grainmerge,$6
-bilateral[0,2] 10,7
-blend[0,2] alpha,$10
rm.

##########################################################

#@gui _<i>Lylejk</i>

#@gui Lylejk's Stencil : fx_lylejk_stencil, fx_lylejk_stencil(0)
#@gui : Amplitude = int(5,1,10)
#@gui : Sharpness = float(10,0,100)
#@gui : Radius = float(3,0,10)
#@gui : Channel(s) = choice("All","RGBA","RGB","Luminance","Blue/red chrominances","Blue chrominance","Red chrominance","Lightness","ab-components","a-component","b-component","Hue","Saturation","Value","Key","Alpha","ch-components","c-component","h-component","Red","Green","Blue","Alpha")
#@gui : sep = separator(), note = note("<small>Authors: <i>Lyle Kroll, David Tschumperl&#233;</i>.      Latest update: <i>2010/29/12</i>.</small>")
fx_lylejk_stencil :
  apply_channels "repeat $1 b $3 unsharp $3,$2 c 0,255 mv. 0 done",$4,0

#@gui Blend [Shape Average] : fx_blend_shapeaverage, fx_blend_shapeaverage(0)
#@gui : Preserve Shading = bool(1)
#@gui : Transparency = bool(0)
#@gui : Revert Layers = bool(0)
#@gui : note = note{"<small><b>Note:</b>
#@gui : This filter needs two layers to work properly. Set the <i>Input layers</i> option to handle multiple input layers.
#@gui : </small>"}
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2011/19/10</i>.</small>")
fx_blend_shapeaverage :
  if ${3=0} _fx_revert_layers fi
  to_rgb
  repeat int($!/2)
    rv[-2,-1]
    if $1 i[0] . fi
    blend[-2,-1] shapeaverage0
    if $1 *[0,-1] /[0] 255 mv[0] $! fi
    if $2 to_rgba. replace_color. 0,0,0,0,0,255,0,0,0,0 fi
  mv. 0 done

#@gui _<i>RL</i>

#@gui RandomWaves : randomwaves, randomwaves
#@gui : Steps Number = int(84,1,1000)
#@gui : Probability of Impulse (% / Step) = float(80.,1.,100.)
#@gui : Lessening = float(1.2,0.01,10.)
#@gui : Random Initialization = int(42,1,100)
#@gui : sep = separator(), note = note("<small>Authors: <i>Jean-Baptiste Rolland, Julien Levillain</i>.      Latest update: <i>2013/28/03</i>.</small>")
randomwaves : check  "isint(${1=84})  &&  ${2=80}>=0  &&  $2<=100  && ${3=1.2}>0. && isint(${4=42})"
  srand $4
  (0,1,0;1,0,1;0,1,0) /. 2
  nm. matconv
  {0,w},{0,h},1,1 set. 255,{u(100)}%,{u(100)}%
  .
  repeat $1
    .
    if ${2}>=u(100)
      circle. {u(100)}%,{u(100)}%,{u(3)},,255
    fi
    convolve. [matconv] /. $3 -. ...
    rm...
  done
  rm[-2,matconv]
  g. a[-1,-2] c -warp[0] .,1 rm.

#@gui Plasma Transition : plasma_transition, plasma_transition
#@gui : Balance = float(0.5,0,1)
#@gui : Scale = int(5,0,50)
#@gui : Smoothness = float(1,0,10)
#@gui : Random Initialization = int(42,1,100)
#@gui : sep = separator(), note = note("<small>Authors: <i>Jean-Baptiste Rolland, Julien Levillain</i>.      Latest update: <i>2013/28/03</i>.</small>")
plasma_transition: check "isint(${4=42}) && isint(${2=5}) && ${1=0.5}>=0  && $1<=1 && $2>=0 && ${3=1}>=0"
  repeat int($!/2)
    local[{$>},{$>+1}]
      if $!<2 return fi
      r ${-max_whds},3
      100%,100% srand $4 plasma. 1,0,$2 n. 0,1
      +<=. $1 b. $3
      rm..
      j... ..,0,0,0,0,1,.
      k...
    endlocal
  done

##########################################################

#@gui _<i>Okyl168</i>

#@gui Jobs Colors : fx_jobs_colors, fx_jobs_colors_preview
#@gui : Gamma = float(0,-2,2)
#@gui : Equalize = bool(0)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>Oberon Leung</i>.      Latest update: <i>2014/25/01</i>.</small>")
fx_jobs_colors :
  n 0,255 if $2 equalize 256 fi
  luminance apply_gamma {10^$1} n 0,9 round
  (22,187,20,36,235,240,245,243,247,209^18,97,147,157,79,110,121,142,170,200^19,158,192,60,67,65,64,64,64,185)
  map[^-1] . rm.

fx_jobs_colors_preview :
  gui_split_preview "fx_jobs_colors $*",$-1

##########################################################

#@gui _<i>Telperion</i>

# ---------------------------------- v 2.2

# ---------------------------------- v 1.1
#@gui Mc_Flou : mc_flou, mc_flou_preview
#@gui : sep = separator()
#@gui : Sharp = float(30,10,400)
#@gui : Blur = float(6,3,20)
#@gui : Blend = float(1,0,1)
#@gui : sep = separator() ,note = note("Base image adjustement:")
#@gui : Skip = bool(true)
#@gui : Gamma = float(1,0.2,2)
#@gui : Value Min = int(0,0,127)
#@gui : Value Max = int(255,128,255)
#@gui : Gamma R = float(1,0.2,2)
#@gui : Gamma G = float(1,0.2,2)
#@gui : Gamma B = float(1,0.2,2)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator() ,note = note("Apply a flou effect with edges protection. v.1.1")

mc_flou:
  # base image value corrections
  if $4==0
    to_rgb
    apply_gamma[0] $5
    c[0] $6,$7 n[0] 0,255    # min max val
    s[0] c
    apply_gamma[0] $8
    apply_gamma[1] $9
    apply_gamma[2] $10
    a[0,1,2] c
  fi
  # -----
  # flou
  +fx_gradient_norm[0] 0,1.5,0,50.38,1,0
  sharpen[0] $1 #30
  b[1] 0.5
  n[1] 0,255
  equalize[1] 4,0%,98%
  +a[0,1] c
  b[2] $2 #10
  blend[0,2] alpha,$3
  remove_opacity[0]
  k[0]

mc_flou_preview:
  gui_split_preview "-mc_flou $*",$-1
# ------------------------------------------

#@gui Mc_Pendraw : mc_pendraw, mc_pendraw_preview
#@gui : sep = separator()
#@gui : Amplitude = float(8,0,30)
#@gui : Blur = float(0.8,0.1,2)
#@gui : Sharp = float(450,100,2000)
#@gui : Color = int(21,4,256)
#@gui : Dithering = float(0.5,0,1)
#@gui : Value = float(1,0,1)
#@gui : Mode 2 = bool(false)
#@gui : Color Equal. = bool(false)
#@gui : Equal. Limit = int(255,100,255)
#@gui : sep = separator()
#@gui : Lowers Contrast = float(0,0,1)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
mc_pendraw:
  repeat $! l[$>]
  split_opacity
  l[0]
  to_rgb
  # contrast mask
  if $10>0
    [0]
    b[0] 1
    negate[0]
    luminance[0]
    rv[0,1]
    blend[0,1] overlay,$10
  fi
  # pendraw
  +fx_gradient_norm[0] 0,1.5,0,50.38,1,0
  [0]
  smooth $1,0.2,1,3,3
  b $2
  sharpen $3
  [0]
  r[0] 20,20,1,3,2
  equalize[0] 256,0%,98%
  index[3] [0],1,1
  rm[0]
  # --
  nm[0] linee
  nm[1] orig
  nm[2] pen
  if $7==0
    rv[pen,linee]
    blend[pen,linee] multiply,1
  elif $7==1
    rv[orig,linee]
    blend[orig,linee] multiply,1
  fi
  n[0] 5,250
  autoindex[0] $4,$5
  rv[0,1]
  blend[0,1] value,$6
  if $8==1
    equalize 21,30,$9
  fi
  endl a c endl done

mc_pendraw_preview:
  gui_split_preview "-mc_pendraw $*",$-1

##########################################################

#@gui _<i>Ronounours</i>

#@gui Krita Helper : fx_krita, fx_krita
fx_krita :
  text="Krita helper:\n"\
       "Image size = "{w}x{h}x{d}x{s}"\n"\
       "Minimal value = "{im}"\n"\
       "Maximal value = "{iM}"\n"\
       "Average value = "{_round(ia,0.1)}"\n\n\n"\
       "* We love Krita! *"
  n 0,255 drgba r 512,512,1,3
  to $text,3,3,5%


#_gui_filter_sources : skip ${1=0}
  # ok_host={['$_host']!='gimp_qt'" && "['$_host']!='krita'" && "['$_host']!='standalone'}
  # ok_host=0
  # file_hc=${_path_rc}hc.gmic
  # if $file_hc # File exist
  #   i raw:$file_hc,uchar c={i[1]} rm.
  #   if $c==126 # Filter already displayed : discard it
  #     if !$1 (35,33) o. raw:{/$file_hc},uchar rm. fi
  #   elif $ok_host
  #     is_too_old={"Y = date(0); M = date(1); D = date(2); date_current = Y*365 + M*31 + D;
  #                  Y = date(0,"$file_hc"); M = date(1,"$file_hc"); D = date(2,"$file_hc"); date_file = Y*365 + M*31 + D;
  #                  delta = date_current - date_file;
  #                  "$c">=125 || ("$c"==32 && delta>12) || ("$c">32 && delta>45 && (delta<60 || delta>200))"}
  #     if $is_too_old
  #       ({'"\#~"\n\
  #          "\#@gui !<span color=\"red\">&#x2764; <b>One-click chocolate !</b></span> : _none_, fx_friends"\n\
  #          "\#@gui : note = note{\"Want to send a <b>free hot chocolate</b> to the <b>hard-working</b> developers who provide G\47MIC <b>for free</b> ?\\n"\n\
  #          "\#@gui : Just follow the link below (or copy/paste into your browser) and click <b>on the sponsored link</b> that is shown. It\47s as simple as that and"\n\
  #          "\#@gui : we\47ll drink to you :)\"}"\n\
  #          "\#@gui : url = link{\"Send a free hot chocolate to the G\47MIC developers\",\"http://gmic.eu/freechocolate.shtml\"}"\n\
  #          "\#@gui : url = link{\"http://gmic.eu/freechocolate.shtml\"}"\n\
  #          "\#@gui : note = note{\"If you\47d like to send <b>more</b> than a single hot chocolate for our efforts, you are welcome too!\"}"\n\
  #          "\#@gui : sep = separator()"\n\
  #          "\#@gui : note = note{\"<small><b>Note:</b> This filter won\47t appear anymore after you re-run the plug-in. So, don\47t miss the occasion!</small>\"}"\n\
  #       @gui/"\/   : sep = separator(), note = note(\"<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>06/17/2016</i>.</small>\")"\n\
  #       '})
  #       o. raw:$file_hc,uchar rm.
  #     else
  #       (35,{$c+1}) o. raw:{/$file_hc},uchar rm.
  #     fi
  #   fi
  # else # File does not exist
  #   if $ok_host (35,32) o. raw:$file_hc,uchar rm. fi
  # fi
  # if $ok_host" && "isfile(['{/$file_hc}']) ({'{/$file_hc}'}) fi

  # l[]
  #   strin="<i><a href=\"http://ow.ly/wpsV30fzhdI\">David Tschumperl&#233;</a></i>"
  #   strout="<i><a href=\"http://ow.ly/wpsV30fzhdI\">David Tschumperl&#233; / <span color=\"#FF6060\">&#x2764;&#x2764;</span></a></i>"
  #   filename=${_path_rc}update$_version.gmic
  #   i raw:$filename,uchar,32
  #   s -,10 is_marked={1,h>1} rm
  #   if $is_marked
  #     i raw:$filename,uchar
  #     replace_str "#@gmic\n##\n","#@gmic\n#\n"
  #     replace_str $strout,$strin
  #     o raw:$filename,uchar
  #   else
  #     if u<0.2
  #       i raw:$filename,uchar
  #       replace_str "#@gmic\n#\n","#@gmic\n##\n"
  #       replace_str $strin,$strout
  #       o raw:$filename,uchar
  #     fi
  #   fi
  #   rm
  # onfail rm
  # endl

#@gui GAAP Test : gaap_test, gaap_test
#@gui : Sigma = float(0,0,100)
#@gui : Color = color(0,0,0)
gaap_test :
  b $1
  u \{{$1+10}\}\{$2,$3,255\}

#@gui Layer Info : gui_layer_info, gui_layer_info_preview
#@gui : Number of Output Layers for Each Input Layer = int(1,1,5)
#@gui : note = note("<small><b>Note:</b> This filter displays layer info on each layer.</small>")
gui_layer_info :
  repeat $! l[$<] nm={n}
    animate b,0,10,$1
    nm $nm
  endl done

  repeat $! l[$>]
    0 t. "Layer indice: ""#"$>"\nLayer name: "${-gui_layer_name}"\nBlending mode: "${-gui_layer_mode}"\nOpacity : "${-gui_layer_opacity}"\nPosition: "${-gui_layer_pos},0,0,40,1,255
    to_rgba[0] expand_xy. 8,0 +dilate. 8 to_colormode[1] {0,s} j[0] [1],20,20,0,0,1,[2],255
    k[0]
  endl done

gui_layer_info_preview :
  gui_layer_info $1
  gui_preview

#@gui Graduated Color Accent : fx_gca, fx_gca_preview
#@gui : Reference Color = color(255,255,255)
#@gui : Amplitude = float(1,0,5)
#@gui : Max Value = choice("From input","From reference color","Maximum allowed")
#@gui : Channel = choice(0,"Saturation","Lightness")
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2015/15/07</i>.</small>")
fx_gca :
  channel={1+$6}
  repeat $! l[$>] to_color split_opacity l[0]
    +fc $1,$2,$3
    -[1] [0] norm[1] /[1] {1e-6+iM} *[1] -1 +[1] 1 ^[1] $4
    rgb2hsl[0] s[0] c
    if $5==0 *[$channel,-1]
    elif $5==1 ($1^$2^$3) rgb2hsl. *[$channel] {i[$channel]} rm[-2,-1]
    else rv[$channel,-1] rm.
    fi
    a c hsl2rgb
  endl a c endl done

fx_gca_preview :
  gui_split_preview "fx_gca $*",$-1

#@gui Faded Mirror : fx_faded_mirror, fx_faded_mirror(1)
#@gui : Axis = choice("x-axis","y-axis")
#@gui : Fading = float(10,0,100)
#@gui : Overlapping = float(10,0,100)
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2013/29/05</i>.</small>")
fx_faded_mirror :
  repeat $! l[$>]
    if $1==0  # X-axis
      100%,1,1,1,"a=1/(1-w*$2%);b=-a*(w-1);a*x+b" c. 0.01,1 *.. .
      r. 100%,.. a c r {2*w-w*$3%},100%,1,100%,0 +mirror x
    else # Y-axis
      1,100%,1,1,"a=1/(1-h*$2%);b=-a*(h-1);a*y+b" c. 0.01,1 r. ..,100% *.. .
      a c r 100%,{2*h-h*$3%},1,100%,0 +mirror y
    fi
     + s. c,-{s-1} /[-2,-1]
  endl done

#@gui Grain [Old] : fx_grain, fx_grain_preview(0)
#@gui : Amplitude = float(40,0,512)
#@gui : Tone Smoothness = float(5,0,15)
#@gui : Grain Type = choice("Gaussian","Uniform")
#@gui : Channel(s) = choice(2,"All","RGBA","RGB","Luminance","Blue/red chrominances","Blue chrominance","Red chrominance","Lightness","ab-components","a-component","b-component","Hue","Saturation","Value","Key","Green chrominance","ch-components","c-component","h-component","Red","Green","Blue","Alpha")
#@gui : sep = separator()
#@gui : note = note("<small><b>Shadows:</b></small>")
#@gui : Strength = float(0.8,0,1)
#@gui : Scale = float(0.5,0,2)
#@gui : Channel Correlation = float(0.5,0,1)
#@gui : sep = separator()
#@gui : note = note("<small><b>Mid-tones:</b></small>")
#@gui : Strength = float(1,0,1)
#@gui : Scale = float(0,0,2)
#@gui : Channel Correlation = float(0.5,0,1)
#@gui : sep = separator()
#@gui : note = note("<small><b>Highlights:</b></small>")
#@gui : Strength = float(0.6,0,1)
#@gui : Scale = float(0.2,0,2)
#@gui : Channel Correlation = float(0.5,0,1)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2013/21/11</i>.</small>")
fx_grain :
  repeat $! l[$>] apply_channels "_fx_grain ${1-13}",$4,0 endl done

_fx_grain :
  if !$1 return fi
  s={s} +luminance

  # Shadows.
  if $5
    100%,100%,1,$s noise. 1,$3 b. $6 *. {(1-$7)/max(abs(im),abs(iM))}
    100%,100%,1,1 noise. 1,$3 b. $6 *. {$7/max(abs(im),abs(iM))}
    +[-2,-1] +ir[1] 0,85 b. $2 n. 0,1 *[-2,-1] *. $5
  fi

  # Midlights.
  if $8
    100%,100%,1,$s noise. 1,$3 b. $9 *. {(1-$10)/max(abs(im),abs(iM))}
    100%,100%,1,1 noise. 1,$3 b. $9 *. {$10/max(abs(im),abs(iM))}
    +[-2,-1] +ir[1] 86,169 b. $2 n. 0,1 *[-2,-1] *. $8
  fi

  # Highlights.
  if $11
    100%,100%,1,$s noise. 1,$3 b. $12 *. {(1-$13)/max(abs(im),abs(iM))}
    100%,100%,1,1 noise. 1,$3 b. $12 *. {$13/max(abs(im),abs(iM))}
    +[-2,-1] +ir[1] 170,256 b. $2 n. 0,1 *[-2,-1] *. $11
  fi

  rm[1] +[-3--1] n. -$1,$1 + c 0,255

fx_grain_preview :
  gui_split_preview "fx_grain $*",$-1

#@gui Shaded Segmentation : dt_segment_shaded,dt_segment_shaded(0)
#@gui : Density = float(1,0,3)
#@gui : Shading = float(0.7,0,2)
#@gui : Smoothness = float(1,0,10)
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2013/01/02</i>.</small>")
dt_segment_shaded :
  repeat $! l[$>]
    b $3 segment_watershed $1,1
    +g xy,1 a[-2,-1] c norm. !=. 0 distance[1] 1 normalize_local. 1000
    n. 0,1 ^. {max(1e-5,$2)} n. 0,255
    blend value
  endl done

#@gui Perspective Scale : fx_perspective_scale, fx_perspective_scale_preview(1)
#@gui : Iterations = int(2,2,10)
#@gui : Factor = float(75,0,100)
#@gui : X-Offset = float(0,-100,100)
#@gui : Y-Offset = float(0,-100,100)
#@gui : Output Mode = _choice("Single layer","Multiple layers")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2013/08/02</i>.</small>")
fx_perspective_scale :
  repeat $! l[$<] to_rgba
    w={w} h={h}
    f=100 repeat $1-1 f={$f*$2%} +r[0] $f%,$f%,1,4,2 done
    repeat $!-1 l[{$>+1}]
      sx={round(($>+1)*$w*$3%/($1-1))}
      sy={round(($>+1)*$h*$4%/($1-1))}
      r $w,$h,1,4,0,0,0.5,0.5 shift. $sx,$sy,0,0,0
    endl done
    if !$5 repeat $!-1 blend[0,1] alpha,1,1 done fi
  endl done

fx_perspective_scale_preview :
  fx_perspective_scale ${1-4},0

#@gui Auto-Adjust Orientation : fx_adjust_orientation, fx_adjust_orientation(1)
#@gui : Threshold = float(5,0,100)
fx_adjust_orientation :
  repeat $!
    M={max(w,h)}
    +gradient_norm. ge. $1%                      # Compute binary contours.
    +*. '1+y' *.. '1+x' a[-2,-1] c               # Extract contours points.
    r. {w*h},2,1,1,-1 sort. +,x autocrop. 0
    /. $M +r. 1,2,1,1,2 r. .. -[-2,-1]    # Estimate main axis.
    +transpose. m*[-2,-1]
    eigen. rm.. z. 0,0
    if i<0 *. -1 fi
    theta={180*atan2(i(0,1),i)/pi}
    rm.
    if w>h rotate. {-$theta},1,0,50%,50%
    else rotate. {-$theta+90},1,0,50%,50%
    fi
  mv. 0 done

#@gui Curves : fx_apply_curve, fx_apply_curve_preview
#@gui : Starting Y = int(0,0,255)
#@gui : sep = separator()
#@gui : X-Coord(1) = int(-1,-1,255)
#@gui : Y-Coord(1) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(2) = int(-1,-1,255)
#@gui : Y-Coord(2) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(3) = int(-1,-1,255)
#@gui : Y-Coord(3) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(4) = int(-1,-1,255)
#@gui : Y-Coord(4) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(5) = int(-1,-1,255)
#@gui : Y-Coord(5) = int(128,0,255)
#@gui : sep = separator()
#@gui : Ending Y = int(255,0,255)
#@gui : sep = separator()
#@gui : Curve Smoothness = float(1,0,1)
#@gui : sep = separator(), Channel(s) = choice("All","RGBA [all]","RGB [all]","RGB [red]","RGB [green]","RGB [blue]","RGBA [alpha]","Linear RGB [all]","Linear RGB [red]","Linear RGB [green]","Linear RGB [blue]","YCbCr [luminance]","YCbCr [blue-red chrominances]","YCbCr [blue chrominance]","YCbCr [red chrominance]","YCbCr [green chrominance]","Lab [lightness]","Lab [ab-chrominances]","Lab [a-chrominance]","Lab [b-chrominance]","Lch [ch-chrominances]","Lch [c-chrominance]","Lch [h-chrominance]","HSV [hue]","HSV [saturation]","HSV [value]","HSI [intensity]","HSL [lightness]","CMYK [cyan]","CMYK [magenta]","CMYK [yellow]","CMYK [key]","YIQ [luma]","YIQ [chromas]")
#@gui : Value Action = choice("None","Cut","Normalize")
#@gui : Display Histogram = float(0,0,1)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2010/29/12</i>.</small>")
fx_apply_curve :
  ac "_fx_apply_curve ${1-13}",$14,$15

_fx_apply_curve :
  apply_curve $13,0,$1,\
                   ${"if $2>=0 u $2,$3, else u \"\" fi"}\
                   ${"if $4>=0 u $4,$5, else u \"\" fi"}\
                   ${"if $6>=0 u $6,$7, else u \"\" fi"}\
                   ${"if $8>=0 u $8,$9, else u \"\" fi"}\
                   ${"if $10>=0 u $10,$11, else u \"\" fi"}\
                   255,$12

fx_apply_curve_preview :
  function1d $13,0,$1,\
                  ${"if $2>=0 u $2,$3, else u \"\" fi"}\
                  ${"if $4>=0 u $4,$5, else u \"\" fi"}\
                  ${"if $6>=0 u $6,$7, else u \"\" fi"}\
                  ${"if $8>=0 u $8,$9, else u \"\" fi"}\
                  ${"if $10>=0 u $10,$11, else u \"\" fi"}\
                  255,$12
  mv. 0
  repeat $!-1
    +gui_split_preview. "fx_apply_curve $*",$-1
    100%,100% axes. 0,255,255,0,13,1,255 +dilate. 3 r.. ... j... ..,0,0,0,0,1,.,255 rm[-2,-1]
    grid. 10%,10%,0,0,0.3,0xCCCCCCCC,255
    line. 0,100%,100%,0,0.3,0xCCCCCCCC,255
    if $-2
      .,. to_gray... histogram... 256,0,255 graph. ...,3,0,0,0,1,1 -!=. 0 *. 255 rm...
      +xor[-2,-1] j... .,0,0,0,0,$16,..,255 rm[-2,-1]
     else rm.. fi
     100%,100% graph. [0],1,0,255,0,1,255 +dilate. 3 r.. ... j... ..,0,0,0,0,1,.,255 rm[-2,-1]
     _fx_apply_curve_preview 0,$1,0 _fx_apply_curve_preview $2,$3,1
     _fx_apply_curve_preview $4,$5,2 _fx_apply_curve_preview $6,$7,3
     _fx_apply_curve_preview $8,$9,4 _fx_apply_curve_preview $10,$11,5
     _fx_apply_curve_preview 255,$12,6
  mv. 1 done rm[0]

_fx_apply_curve_preview :
  if $1>=0
    x={$1*100/255}% y={100-$2*100/255}%
    ellipse. $x,$y,3,3,0,1,0xFFFFFFFF,0,0,0 ellipse. $x,$y,2,2,0,1,0,255,0
    t. $3,$x,{$y*h-20},13,1,255
  fi

#@gui Curves [RGB]
#@gui Red : fx_apply_RGBcurve, fx_apply_Rcurve_preview
#@gui : Starting Y = int(0,0,255)
#@gui : sep = separator()
#@gui : X-Coord(1) = int(-1,-1,255)
#@gui : Y-Coord(1) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(2) = int(-1,-1,255)
#@gui : Y-Coord(2) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(3) = int(-1,-1,255)
#@gui : Y-Coord(3) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(4) = int(-1,-1,255)
#@gui : Y-Coord(4) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(5) = int(-1,-1,255)
#@gui : Y-Coord(5) = int(128,0,255)
#@gui : sep = separator()
#@gui : Ending Y = int(255,0,255)
#@gui : sep = separator()
#@gui : Curve Smoothness = float(1,0,1)
#@gui : Display Histogram = float(0,0,100)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2010/29/12</i>.</small>")

#@gui Green : fx_apply_RGBcurve, fx_apply_Gcurve_preview
#@gui : Starting Y = int(0,0,255)
#@gui : sep = separator()
#@gui : X-Coord(1) = int(-1,-1,255)
#@gui : Y-Coord(1) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(2) = int(-1,-1,255)
#@gui : Y-Coord(2) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(3) = int(-1,-1,255)
#@gui : Y-Coord(3) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(4) = int(-1,-1,255)
#@gui : Y-Coord(4) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(5) = int(-1,-1,255)
#@gui : Y-Coord(5) = int(128,0,255)
#@gui : sep = separator()
#@gui : Ending Y = int(255,0,255)
#@gui : sep = separator()
#@gui : Curve Smoothness = float(1,0,1)
#@gui : Display Histogram = float(0,0,100)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2010/29/12</i>.</small>")

#@gui Blue : fx_apply_RGBcurve, fx_apply_Bcurve_preview
#@gui : Starting Y = int(0,0,255)
#@gui : sep = separator()
#@gui : X-Coord(1) = int(-1,-1,255)
#@gui : Y-Coord(1) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(2) = int(-1,-1,255)
#@gui : Y-Coord(2) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(3) = int(-1,-1,255)
#@gui : Y-Coord(3) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(4) = int(-1,-1,255)
#@gui : Y-Coord(4) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(5) = int(-1,-1,255)
#@gui : Y-Coord(5) = int(128,0,255)
#@gui : sep = separator()
#@gui : Ending Y = int(255,0,255)
#@gui : sep = separator()
#@gui : Curve Smoothness = float(1,0,1)
#@gui : Display Histogram = float(0,0,100)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2010/29/12</i>.</small>")
#@gui _
fx_apply_RGBcurve : skip $1
  fx_apply_RGBcurve_configfile
  repeat $!-1 l[$>,-1]
    to_colormode[0] {max(3,s)}
    sh[0] 0 _fx_apply_RGBcurve. {-2,@0-12} rm.
    sh[0] 1 _fx_apply_RGBcurve. {-2,@13-25} rm.
    sh[0] 2 _fx_apply_RGBcurve. {-2,@26-38} rm.
  endl done
  rm.

_fx_apply_RGBcurve :
  apply_curve $13,0,$1,\
                   ${"if $2>=0 u $2,$3, else u \"\" fi"}\
                   ${"if $4>=0 u $4,$5, else u \"\" fi"}\
                   ${"if $6>=0 u $6,$7, else u \"\" fi"}\
                   ${"if $8>=0 u $8,$9, else u \"\" fi"}\
                   ${"if $10>=0 u $10,$11, else u \"\" fi"}\
                   255,$12
  c 0,255

fx_apply_Rcurve_preview :
  fx_apply_RGBcurve_configfile
  sh. 0,0,0,0 f. ${1--3} rm.
  fx_apply_RGBcurve_preview[^-1] {^},0,${-2,-1} rm.

fx_apply_Gcurve_preview :
  fx_apply_RGBcurve_configfile
  sh. 1,1,0,0 f. ${1--3} rm.
  fx_apply_RGBcurve_preview[^-1] {^},1,${-2,-1} rm.

fx_apply_Bcurve_preview :
  fx_apply_RGBcurve_configfile
  sh. 2,2,0,0 f. ${1--3} rm.
  fx_apply_RGBcurve_preview[^-1] {^},2,${-2,-1} rm.

fx_apply_RGBcurve_configfile :
  filename=${-path_tmp}.gmic_RGBcurve.dlm
  if isfile([{'{/$filename}']) $filename else (0,-1,128,-1,128,-1,128,-1,128,-1,128,255,1) r. 100%,3 fi

fx_apply_RGBcurve_preview :
  (${1--3}) r. 13,3,1,1,-1 o. ${-path_tmp}.gmic_RGBcurve.dlm rm.
  function1d $13,0,$1,\
                  ${"if $2>=0 u $2,$3, else u \"\" fi"}\
                  ${"if $4>=0 u $4,$5, else u \"\" fi"}\
                  ${"if $6>=0 u $6,$7, else u \"\" fi"}\
                  ${"if $8>=0 u $8,$9, else u \"\" fi"}\
                  ${"if $10>=0 u $10,$11, else u \"\" fi"}\
                  255,$12
  function1d $26,0,$14,\
                  ${"if $15>=0 u $15,$16, else u \"\" fi"}\
                  ${"if $17>=0 u $17,$18, else u \"\" fi"}\
                  ${"if $19>=0 u $19,$20, else u \"\" fi"}\
                  ${"if $21>=0 u $21,$22, else u \"\" fi"}\
                  ${"if $23>=0 u $23,$24, else u \"\" fi"}\
                  255,$25
  function1d $39,0,$27,\
                  ${"if $28>=0 u $28,$29, else u \"\" fi"}\
                  ${"if $30>=0 u $30,$31, else u \"\" fi"}\
                  ${"if $32>=0 u $32,$33, else u \"\" fi"}\
                  ${"if $34>=0 u $34,$35, else u \"\" fi"}\
                  ${"if $36>=0 u $36,$37, else u \"\" fi"}\
                  255,$38
  a[-3--1] y mv. 0
  repeat $!-1
    +gui_split_preview. "fx_apply_RGBcurve 0",$-1
    100%,100% axes. 0,255,255,0,13,1,255 +dilate. 3 r.. ... j... ..,0,0,0,0,1,.,255 rm[-2,-1]
    grid. 10%,10%,0,0,0.3,0xCCCCCCCC,255
    line. 0,100%,100%,0,0.3,0xCCCCCCCC,255
     if $-2
        .,.,1,1,-{$-2*255/100} to_gray... histogram... 256,0,255 graph. ...,3,0,0,0,1,0
        rm... +. {$-2*255/100} +[-2,-1] c. 0,255
     else rm.. fi
     line. 0,100%,100%,0,0.3,0xCCCCCCCC,255
     sh[0] 0,0,0,0
     graph.. .,1,0,255,0,1,255,128,128 -. 1
     graph.. .,1,0,255,0,0.5,200,0,0 rm.
     sh[0] 1,1,0,0
     graph.. .,1,0,255,0,1,128,255,128 -. 1
     graph.. .,1,0,255,0,0.5,0,200,0 rm.
     sh[0] 2,2,0,0
     graph.. .,1,0,255,0,1,128,128,255 -. 1
     graph.. .,1,0,255,0,0.5,0,0,200 rm.
     if $40==0
       _fx_apply_curve_preview 0,$1,0 _fx_apply_curve_preview $2,$3,1
       _fx_apply_curve_preview $4,$5,2 _fx_apply_curve_preview $6,$7,3
       _fx_apply_curve_preview $8,$9,4 _fx_apply_curve_preview $10,$11,5
       _fx_apply_curve_preview 255,$12,6
     elif $40==1
       _fx_apply_curve_preview 0,$14,0 _fx_apply_curve_preview $15,$16,1
       _fx_apply_curve_preview $17,$18,2 _fx_apply_curve_preview $19,$20,3
       _fx_apply_curve_preview $21,$22,4 _fx_apply_curve_preview $23,$24,5
       _fx_apply_curve_preview 255,$25,6
     else
       _fx_apply_curve_preview 0,$27,0 _fx_apply_curve_preview $28,$29,1
       _fx_apply_curve_preview $30,$31,2 _fx_apply_curve_preview $32,$33,3
       _fx_apply_curve_preview $34,$35,4 _fx_apply_curve_preview $36,$37,5
       _fx_apply_curve_preview 255,$38,6
     fi
  mv. 1 done rm[0]

#@gui Curves [YCbCr]
#@gui Luminance : fx_apply_YCbCrcurve, fx_apply_Ycurve_preview
#@gui : Starting Y = int(0,0,255)
#@gui : sep = separator()
#@gui : X-Coord(1) = int(-1,-1,255)
#@gui : Y-Coord(1) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(2) = int(-1,-1,255)
#@gui : Y-Coord(2) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(3) = int(-1,-1,255)
#@gui : Y-Coord(3) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(4) = int(-1,-1,255)
#@gui : Y-Coord(4) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(5) = int(-1,-1,255)
#@gui : Y-Coord(5) = int(128,0,255)
#@gui : sep = separator()
#@gui : Ending Y = int(255,0,255)
#@gui : sep = separator()
#@gui : Curve Smoothness = float(1,0,1)
#@gui : Display Histogram = float(0,0,100)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2010/29/12</i>.</small>")

#@gui Blue Chrominance : fx_apply_YCbCrcurve, fx_apply_Cbcurve_preview
#@gui : Starting Y = int(0,0,255)
#@gui : sep = separator()
#@gui : X-Coord(1) = int(-1,-1,255)
#@gui : Y-Coord(1) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(2) = int(-1,-1,255)
#@gui : Y-Coord(2) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(3) = int(-1,-1,255)
#@gui : Y-Coord(3) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(4) = int(-1,-1,255)
#@gui : Y-Coord(4) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(5) = int(-1,-1,255)
#@gui : Y-Coord(5) = int(128,0,255)
#@gui : sep = separator()
#@gui : Ending Y = int(255,0,255)
#@gui : sep = separator()
#@gui : Curve Smoothness = float(1,0,1)
#@gui : Display Histogram = float(0,0,100)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2010/29/12</i>.</small>")

#@gui Red Chrominance : fx_apply_YCbCrcurve, fx_apply_Crcurve_preview
#@gui : Starting Y = int(0,0,255)
#@gui : sep = separator()
#@gui : X-Coord(1) = int(-1,-1,255)
#@gui : Y-Coord(1) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(2) = int(-1,-1,255)
#@gui : Y-Coord(2) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(3) = int(-1,-1,255)
#@gui : Y-Coord(3) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(4) = int(-1,-1,255)
#@gui : Y-Coord(4) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(5) = int(-1,-1,255)
#@gui : Y-Coord(5) = int(128,0,255)
#@gui : sep = separator()
#@gui : Ending Y = int(255,0,255)
#@gui : sep = separator()
#@gui : Curve Smoothness = float(1,0,1)
#@gui : Display Histogram = float(0,0,100)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2010/29/12</i>.</small>")
#@gui _
fx_apply_YCbCrcurve : skip $1
  fx_apply_YCbCrcurve_configfile
  repeat $!-1 l[$>,-1]
    to_colormode[0] {max(3,s)} sh[0] 0,2 rgb2ycbcr. rm.
    sh[0] 0 _fx_apply_YCbCrcurve. {-2,@0-12} rm.
    sh[0] 1 _fx_apply_YCbCrcurve. {-2,@13-25} rm.
    sh[0] 2 _fx_apply_YCbCrcurve. {-2,@26-38} rm.
    sh[0] 0,2 -ycbcr2rgb. rm.
  endl done
  rm.

_fx_apply_YCbCrcurve :
  apply_curve $13,0,$1,\
                   ${"if $2>=0 u $2,$3, else u \"\" fi"}\
                   ${"if $4>=0 u $4,$5, else u \"\" fi"}\
                   ${"if $6>=0 u $6,$7, else u \"\" fi"}\
                   ${"if $8>=0 u $8,$9, else u \"\" fi"}\
                   ${"if $10>=0 u $10,$11, else u \"\" fi"}\
                   255,$12
  c 0,255

fx_apply_Ycurve_preview :
  fx_apply_YCbCrcurve_configfile
  sh. 0,0,0,0 f. ${1--3} rm.
  fx_apply_YCbCrcurve_preview[^-1] {^},0,${-2,-1} rm.

fx_apply_Cbcurve_preview :
  fx_apply_YCbCrcurve_configfile
  sh. 1,1,0,0 f. ${1--3} rm.
  fx_apply_YCbCrcurve_preview[^-1] {^},1,${-2,-1} rm.

fx_apply_Crcurve_preview :
  fx_apply_YCbCrcurve_configfile
  sh. 2,2,0,0 f. ${1--3} rm.
  fx_apply_YCbCrcurve_preview[^-1] {^},2,${-2,-1} rm.

fx_apply_YCbCrcurve_configfile :
  filename=${-path_tmp}.gmic_YCbCrcurve.dlm
  if isfile(['{/$filename}']) $filename else (0,-1,128,-1,128,-1,128,-1,128,-1,128,255,1) r. 100%,3 fi

fx_apply_YCbCrcurve_preview :
  (${1--3}) r. 13,3,1,1,-1 o. ${-path_tmp}.gmic_YCbCrcurve.dlm rm.
  function1d $13,0,$1,\
                  ${"if $2>=0 u $2,$3, else u \"\" fi"}\
                  ${"if $4>=0 u $4,$5, else u \"\" fi"}\
                  ${"if $6>=0 u $6,$7, else u \"\" fi"}\
                  ${"if $8>=0 u $8,$9, else u \"\" fi"}\
                  ${"if $10>=0 u $10,$11, else u \"\" fi"}\
                  255,$12
  function1d $26,0,$14,\
                  ${"if $15>=0 u $15,$16, else u \"\" fi"}\
                  ${"if $17>=0 u $17,$18, else u \"\" fi"}\
                  ${"if $19>=0 u $19,$20, else u \"\" fi"}\
                  ${"if $21>=0 u $21,$22, else u \"\" fi"}\
                  ${"if $23>=0 u $23,$24, else u \"\" fi"}\
                  255,$25
  function1d $39,0,$27,\
                  ${"if $28>=0 u $28,$29, else u \"\" fi"}\
                  ${"if $30>=0 u $30,$31, else u \"\" fi"}\
                  ${"if $32>=0 u $32,$33, else u \"\" fi"}\
                  ${"if $34>=0 u $34,$35, else u \"\" fi"}\
                  ${"if $36>=0 u $36,$37, else u \"\" fi"}\
                  255,$38
  a[-3--1] y mv. 0
  repeat $!-1
    +gui_split_preview. "fx_apply_YCbCrcurve 0",$-1
    axes. 0,255,255,0,13,1,255
    100%,100% axes. 0,255,255,0,13,1,255 +dilate. 3 r.. ... j... ..,0,0,0,0,1,.,255 rm[-2,-1]
    grid. 10%,10%,0,0,0.3,0xCCCCCCCC,255
    line. 0,100%,100%,0,0.3,0xCCCCCCCC,255
     if $-2
        .,.,1,1,-{$-2*255/100} to_gray... histogram... 256,0,255 graph. ...,3,0,0,0,1,0
        rm... +. {$-2*255/100} +[-2,-1] c. 0,255
     else rm.. fi
     line. 0,100%,100%,0,0.3,0xCCCCCCCC,255
     sh[0] 0,0,0,0
     graph.. .,1,0,255,0,1,255,255,255 -. 1
     graph.. .,1,0,255,0,0.5,200,200,200 rm.
     sh[0] 1,1,0,0
     graph.. .,1,0,255,0,1,128,128,255 -. 1
     graph.. .,1,0,255,0,0.5,0,0,200 rm.
     sh[0] 2,2,0,0
     graph.. .,1,0,255,0,1,255,128,128 -. 1
     graph.. .,1,0,255,0,0.5,200,0,0 rm.
     if $40==0
       _fx_apply_curve_preview 0,$1,0 _fx_apply_curve_preview $2,$3,1
       _fx_apply_curve_preview $4,$5,2 _fx_apply_curve_preview $6,$7,3
       _fx_apply_curve_preview $8,$9,4 _fx_apply_curve_preview $10,$11,5
       _fx_apply_curve_preview 255,$12,6
     elif $40==1
       _fx_apply_curve_preview 0,$14,0 _fx_apply_curve_preview $15,$16,1
       _fx_apply_curve_preview $17,$18,2 _fx_apply_curve_preview $19,$20,3
       _fx_apply_curve_preview $21,$22,4 _fx_apply_curve_preview $23,$24,5
       _fx_apply_curve_preview 255,$25,6
     else
       _fx_apply_curve_preview 0,$27,0 _fx_apply_curve_preview $28,$29,1
       _fx_apply_curve_preview $30,$31,2 _fx_apply_curve_preview $32,$33,3
       _fx_apply_curve_preview $34,$35,4 _fx_apply_curve_preview $36,$37,5
       _fx_apply_curve_preview 255,$38,6
     fi
  mv. 1 done rm[0]

#@gui Curves [Lab]
#@gui Lightness : fx_apply_Labcurve, fx_apply_Lcurve_preview
#@gui : Starting Y = int(0,0,255)
#@gui : sep = separator()
#@gui : X-Coord(1) = int(-1,-1,255)
#@gui : Y-Coord(1) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(2) = int(-1,-1,255)
#@gui : Y-Coord(2) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(3) = int(-1,-1,255)
#@gui : Y-Coord(3) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(4) = int(-1,-1,255)
#@gui : Y-Coord(4) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(5) = int(-1,-1,255)
#@gui : Y-Coord(5) = int(128,0,255)
#@gui : sep = separator()
#@gui : Ending Y = int(255,0,255)
#@gui : sep = separator()
#@gui : Curve Smoothness = float(1,0,1)
#@gui : Display Histogram = float(0,0,100)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2010/29/12</i>.</small>")

#@gui A-Color : fx_apply_Labcurve, fx_apply_acurve_preview
#@gui : Starting Y = int(0,0,255)
#@gui : sep = separator()
#@gui : X-Coord(1) = int(-1,-1,255)
#@gui : Y-Coord(1) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(2) = int(-1,-1,255)
#@gui : Y-Coord(2) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(3) = int(-1,-1,255)
#@gui : Y-Coord(3) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(4) = int(-1,-1,255)
#@gui : Y-Coord(4) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(5) = int(-1,-1,255)
#@gui : Y-Coord(5) = int(128,0,255)
#@gui : sep = separator()
#@gui : Ending Y = int(255,0,255)
#@gui : sep = separator()
#@gui : Curve Smoothness = float(1,0,1)
#@gui : Display Histogram = float(0,0,100)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2010/29/12</i>.</small>")

#@gui B-Color : fx_apply_Labcurve, fx_apply_bcurve_preview
#@gui : Starting Y = int(0,0,255)
#@gui : sep = separator()
#@gui : X-Coord(1) = int(-1,-1,255)
#@gui : Y-Coord(1) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(2) = int(-1,-1,255)
#@gui : Y-Coord(2) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(3) = int(-1,-1,255)
#@gui : Y-Coord(3) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(4) = int(-1,-1,255)
#@gui : Y-Coord(4) = int(128,0,255)
#@gui : sep = separator()
#@gui : X-Coord(5) = int(-1,-1,255)
#@gui : Y-Coord(5) = int(128,0,255)
#@gui : sep = separator()
#@gui : Ending Y = int(255,0,255)
#@gui : sep = separator()
#@gui : Curve Smoothness = float(1,0,1)
#@gui : Display Histogram = float(0,0,100)
#@gui : sep = separator(), Preview type = choice("Full","Forward horizontal","Forward vertical","Backward horizontal","Backward vertical","Duplicate top","Duplicate left","Duplicate bottom","Duplicate right","Duplicate horizontal","Duplicate vertical","Checkered","Checkered inverse")
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.      Latest update: <i>2010/29/12</i>.</small>")
#@gui _
fx_apply_Labcurve : skip $1
  fx_apply_Labcurve_configfile
  repeat $!-1 l[$>,-1]
    to_colormode[0] {max(3,s)} sh[0] 0,2 rgb2lab. rm.
    sh[0] 0 *. 2.55 _fx_apply_Labcurve. {-2,@0-12} /. 2.55 rm.
    sh[0] 1 +. 86 *. 1.38587 _fx_apply_Labcurve. {-2,@13-25} /. 1.38587 -. 86 rm.
    sh[0] 2 +. 108 *. 1.25616 _fx_apply_Labcurve. {-2,@26-38} /. 1.25616 -. 108 rm.
    sh[0] 0,2 lab2rgb. rm.
  endl done
  rm.

_fx_apply_Labcurve :
  apply_curve $13,0,$1,\
                   ${"if $2>=0 u $2,$3, else u \"\" fi"}\
                   ${"if $4>=0 u $4,$5, else u \"\" fi"}\
                   ${"if $6>=0 u $6,$7, else u \"\" fi"}\
                   ${"if $8>=0 u $8,$9, else u \"\" fi"}\
                   ${"if $10>=0 u $10,$11, else u \"\" fi"}\
                   255,$12
  c 0,255

fx_apply_Lcurve_preview :
  fx_apply_Labcurve_configfile
  sh. 0,0,0,0 f. ${1--3} rm.
  fx_apply_Labcurve_preview[^-1] {^},0,${-2,-1} rm.

fx_apply_acurve_preview :
  fx_apply_Labcurve_configfile
  sh. 1,1,0,0 f. ${1--3} rm.
  fx_apply_Labcurve_preview[^-1] {^},1,${-2,-1} rm.

fx_apply_bcurve_preview :
  fx_apply_Labcurve_configfile
  sh. 2,2,0,0 f. ${1--3} rm.
  fx_apply_Labcurve_preview[^-1] {^},2,${-2,-1} rm.

fx_apply_Labcurve_configfile :
  filename=${-path_tmp}.gmic_Labcurve.dlm
  if isfile(['{/$filename}']) $filename else (0,-1,128,-1,128,-1,128,-1,128,-1,128,255,1) r. 100%,3 fi

fx_apply_Labcurve_preview :
  (${1--3}) r. 13,3,1,1,-1 o. ${-path_tmp}.gmic_Labcurve.dlm rm.
  function1d $13,0,$1,\
                  ${"if $2>=0 u $2,$3, else u \"\" fi"}\
                  ${"if $4>=0 u $4,$5, else u \"\" fi"}\
                  ${"if $6>=0 u $6,$7, else u \"\" fi"}\
                  ${"if $8>=0 u $8,$9, else u \"\" fi"}\
                  ${"if $10>=0 u $10,$11, else u \"\" fi"}\
                  255,$12
  function1d $26,0,$14,\
                  ${"if $15>=0 u $15,$16, else u \"\" fi"}\
                  ${"if $17>=0 u $17,$18, else u \"\" fi"}\
                  ${"if $19>=0 u $19,$20, else u \"\" fi"}\
                  ${"if $21>=0 u $21,$22, else u \"\" fi"}\
                  ${"if $23>=0 u $23,$24, else u \"\" fi"}\
                  255,$25
  function1d $39,0,$27,\
                  ${"if $28>=0 u $28,$29, else u \"\" fi"}\
                  ${"if $30>=0 u $30,$31, else u \"\" fi"}\
                  ${"if $32>=0 u $32,$33, else u \"\" fi"}\
                  ${"if $34>=0 u $34,$35, else u \"\" fi"}\
                  ${"if $36>=0 u $36,$37, else u \"\" fi"}\
                  255,$38
  a[-3--1] y mv. 0
  repeat $!-1
    +gui_split_preview. "fx_apply_Labcurve 0",$-1
    axes. 0,255,255,0,13,1,255
    100%,100% axes. 0,255,255,0,13,1,255 +dilate. 3 r.. ... j... ..,0,0,0,0,1,.,255 rm[-2,-1]
    grid. 10%,10%,0,0,0.3,0xCCCCCCCC,255
    line. 0,100%,100%,0,0.3,0xCCCCCCCC,255
     if $-2
        .,.,1,1,-{$-2*255/100} to_gray... histogram... 256,0,255 graph. ...,3,0,0,0,1,0
        rm... +. {$-2*255/100} +[-2,-1] c. 0,255
     else rm.. fi
     line. 0,100%,100%,0,0.3,0xCCCCCCCC,255
     sh[0] 0,0,0,0
     graph.. .,1,0,255,0,1,255,255,255 -. 1
     graph.. .,1,0,255,0,0.5,200,200,200 rm.
     sh[0] 1,1,0,0
     graph.. .,1,0,255,0,1,255,128,128 -. 1
     graph.. .,1,0,255,0,0.5,200,0,0 rm.
     sh[0] 2,2,0,0
     graph.. .,1,0,255,0,1,128,128,255 -. 1
     graph.. .,1,0,255,0,0.5,0,0,200 rm.
     if $40==0
       _fx_apply_curve_preview 0,$1,0 _fx_apply_curve_preview $2,$3,1
       _fx_apply_curve_preview $4,$5,2 _fx_apply_curve_preview $6,$7,3
       _fx_apply_curve_preview $8,$9,4 _fx_apply_curve_preview $10,$11,5
       _fx_apply_curve_preview 255,$12,6
     elif $40==1
       _fx_apply_curve_preview 0,$14,0 _fx_apply_curve_preview $15,$16,1
       _fx_apply_curve_preview $17,$18,2 _fx_apply_curve_preview $19,$20,3
       _fx_apply_curve_preview $21,$22,4 _fx_apply_curve_preview $23,$24,5
       _fx_apply_curve_preview 255,$25,6
     else
       _fx_apply_curve_preview 0,$27,0 _fx_apply_curve_preview $28,$29,1
       _fx_apply_curve_preview $30,$31,2 _fx_apply_curve_preview $32,$33,3
       _fx_apply_curve_preview $34,$35,4 _fx_apply_curve_preview $36,$37,5
       _fx_apply_curve_preview 255,$38,6
     fi
  mv. 1 done rm[0]


cracks_old : skip ${1=0.2},${2=40},${3=0}
  e[^-1] "Add random cracks to image$?, with density $1."
  v - repeat $! l[$>]
    ({im},{iM}) ..,..,1,1 noise. $1,2 ==. 1 distance. 1 sharpen. 10000
    if $3 g. xy +[-2,-1] n. -1,1 else n. 0,1 fi
    *. $2 +[-3,-1] c.. {^} rm.
  endl done v +

fx_cracks_old :
  ac "-cracks_old $1,$2,$3",$4

negative :
  e[^-1] "Compute negative of image$?."
  v - repeat $! l[$>] - {iM} endl done * -1 v +

transfer_colors : skip ${2=0}
  e[^-1] "Transfer colors of image $1 to image$?."
  v - pass$1 0 mv. 0 to_rgb[0] to_colormode[^0] {max(3,${-max_s})} c 0,255   # Convert all images to RGB[A]
  repeat $! l[$>] split_opacity rgb2ycbcr[0] a c endl done                   # Perform RGB[A] to YCbCr[A] conversion.
  l[0] s c histogram_cumul 256,1,0,255 a c * 255 endl                        # Compute channel-by-channel cumulative histogram of target image.
  repeat $!-1 l[0,{$<+1}]
    if $2 repeat 3 sh[0,1] $> equalize. 256,0,255 index. ..,0,0 rm[-2,-1] done     # Transfer brightness + colors.
    else repeat 2 sh[0,1] {$>+1} equalize. 256,0,255 index. ..,0,0 rm[-2,-1] done  # Transfer colors only.
    fi
  endl done rm[0]
  repeat $! l[$>] split_opacity ycbcr2rgb[0] a c endl done    # Perform YCbCr[A] to RGB[A] conversion.
  c 0,255
  v +

_transfer_colors :  # Check transfer_colors performance.
  repeat $! l[$>] rgb2ycbcr s c histogram 256,0,255 a c -dg 300,200 endl done

patchmatch : skip ${3=$2},${4=1},${5=5},${6=5},${7=0}
  pass$1
  matchpatch[^-1] .,${2-6},0,${7--1}
  rm.

matchpatch : skip ${3=$2},${4=1},${5=5},${6=5},${7=0},${8=0}
  pass$1
  patchmatch[^-1] .,${2-6},${8--1}
  rm.

#@gui ____<b>Artistic</b>
#--------------------------

#@gui Stylize : fx_stylize,fx_stylize_preview
#@gui : Style = choice{0,"Custom Style (Top Layer)","Custom Style (Bottom Layer)",
#@gui : "Braque: Landscape near Antwerp",
#@gui : "Braque: Le Viaduc &agrave; l'Estaque",
#@gui : "Braque: Little Bay at La Ciotat",
#@gui : "Braque: The Mandola",
#@gui : "Delaunay: Windows Open Simultaneously",
#@gui : "Delaunay: Portrait de Metzinger",
#@gui : "Hokusai: The Great Wave",
#@gui : "Kandinsky: Squares with Concentric Circles",
#@gui : "Kandinsky: Yellow-Red-Blue",
#@gui : "Klee: Death and Fire",
#@gui : "Klee: In the Style of Kairouan",
#@gui : "Klee: Oriental Pleasure Garden Anagoria",
#@gui : "Klee: Polyphony 2",
#@gui : "Klee: Red waistcoat",
#@gui : "Klimt: The Kiss",
#@gui : "Mondrian: Composition in Red-Yellow-Blue",
#@gui : "Mondrian: Evening; Red Tree",
#@gui : "Mondrian: Gray Tree",
#@gui : "Monet: San Giorgio Maggiore at Dusk",
#@gui : "Monet: Water-Lily Pond",
#@gui : "Monet: Wheatstacks - End of Summer",
#@gui : "Munch: The Scream",
#@gui : "Picabia: Udnie",
#@gui : "Picasso: Les Demoiselles d'Avignon",
#@gui : "Picasso: Seated Woman",
#@gui : "Picasso: The Reservoir - Horta de Ebro",
#@gui : "Pollock: Convergence",
#@gui : "Pollock: Summertime Number 9A",
#@gui : "Van Gogh; Almond Blossom",
#@gui : "Van Gogh; Irises",
#@gui : "Van Gogh: The Starry Night",
#@gui : "Van Gogh: Wheat Field with Crows"}
#@gui : Scale Style to Fit Target Resolution = choice(6,"No rescaling","10%","20%","30%","50%","75%","100%","150%","200%","250%","300%")
#@gui : Style variations = choice("None","All XY-flips","All 90&deg; rotations","All 45&deg; rotations")
#@gui : Preview Progression While Running = bool(1)
#@gui : sep = separator(), note = note{"<small><b><span color="blue">Style/Target Parameters:</span></b></small>"}
#@gui : Fidelity to target (finest) = float(0.5,0,5)
#@gui : Fidelity to target (coarsest) = float(3,0,5)
#@gui : Fidelity smoothness (finest) = float(3,0,5)
#@gui : Fidelity smoothness (coarsest) = float(0.5,0,5)
#@gui : Fidelity chromaticity = float(0.1,0,1)
#@gui : sep = separator(), note = note{"<small><b><span color="blue">Image Matching Parameters:</span></b></small>"}
#@gui : Match Colors with = choice(2,"Nothing","Gamma Balance","Histogram Transfer")
#@gui : Colorspace = choice{5,"sRGB","Linear RGB","YCbCr","YCbCr (Luma Only)","YCbCr (Chroma Only)","Lab","Lab (Luma Only)","Lab (Chroma Only)"}
#@gui : Keep Color Channels = choice{"All","Luminance Only (YCbCr)","Luminance Only (Lab)","Chrominances Only (CbCr)","Chrominances Only (ab)"}
#@gui : Smoothness = float(0.7,0,5)
#@gui : Also match gradients = float(1,0,5)
#@gui : sep = separator(), note = note{"<small><b><span color="blue">Advanced Parameters:</span></b></small>"}
#@gui : Init. type = choice("Best Match","Identity","Randomized")
#@gui : Init. resolution = choice(1,"8px","16px","32px","64px","128px","256px")
#@gui : Init. with high gradients only = float(0,0,100)
#@gui : Patch size for analysis = int(5,2,16)
#@gui : Patch size for synthesis = int(5,2,16)
#@gui : Patch size for synthesis (final) = int(7,2,16)
#@gui : Number of matches (finest) = int(1,0,10)
#@gui : Number of matches (coarsest) = int(30,0,200)
#@gui : Penalize patch repetitions = int(1000,0,2000)
#@gui : Matching precision (smaller is faster) = float(2,0,10)
#@gui : Scale factor = float(1.85,1.1,4)
#@gui : Skip finest scales = int(0,0,3)
#@gui : sep = separator(), note = note("<small>Author: <i>David Tschumperl&#233;</i>.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Latest Update: <i>2019/01/10</i>.</small>")
fx_stylize : l[] if !narg($$stylize) _fx_stylize_ fi onfail endl
  init_resolution={arg(1+$16,8,16,32,64,128,256)}

  # Define image matching function
  colorspace=${"arg 1+$11,all,lrgb,ycbcr,ycbcr_y,ycbcr_cbcr,lab,lab_l,lab_ab"}
  match_colors="s c,-3 mv[1] 3 b[-2,-1] 1% negate[-2,-1] n[-2,-1] 0,1"
  if $10==1 match_colors=$match_colors" ac[0,1] \"balance_gamma ,\","$colorspace
  elif $10==2 match_colors=$match_colors" transfer_histogram[0] [1],256,"$colorspace
  fi
  if $12==1 match_colors=$match_colors" rgb2ycbcr[0,1] sh[0,1] 1,2 f[-2,-1] 128 rm[-2,-1] ycbcr2rgb[0,1]"
  elif $12==2 match_colors=$match_colors" srgb2lab[0,1] sh[0,1] 1,2 f[-2,-1] 0 rm[-2,-1] lab2srgb[0,1]"
  elif $12==3 match_colors=$match_colors" rgb2ycbcr[0,1] sh[0,1] 0 f[-2,-1] 128 rm[-2,-1] ycbcr2rgb[0,1]"
  elif $12==4 match_colors=$match_colors" srgb2lab[0,1] sh[0,1] 0 f[-2,-1] 50 rm[-2,-1] lab2srgb[0,1]"
  fi
  match_colors=$match_colors" b[0,1] xy,$13 repeat 2 l[$>] s c n 0,255 a c endl done *[-2,-1] {$14*255} a[0,-2] c a[1,-1] c"

  # Insert style image at the end of the list.
  if $1<2 # Custom style (top or bottom layer)
    if $!<2 error "At least two layers are required in this mode." fi
    ind_first={$1==0?1:0} ind_style={$1==0?0:-1} N={$!-1} sh[$ind_style]
  else
    ind_first=0 N=$! ind_style= _fx_stylize {$1-2}
  fi

  # Process layers.
  is_window=0
  repeat $N l[{$ind_first+$>},-1] nm={0,n}
    if $2 +rr2d[1] {0,[w,h]*arg($2,0.1,0.2,0.3,0.5,0.75,1,1.5,2,2.5,3)},1,2 fi
    if $3==1 . +mirror. x +mirror[-2,-1] y a[-4--1] z
    elif $3==2 +l. r {u={max(w,h)};[u,u]},1,100%,0,3,0.5,0.5 repeat 3 +rotate[0] {90*$>},1,3,50%,50% done a z endl
    elif $3==3 +l. r {u={max(w,h)};[u,u]},1,100%,0,3,0.5,0.5 repeat 7 +rotate[0] {45*$>},1,3,50%,50% done a z endl
    fi
    if $4 wsiz=${"fitscreen "{0,[w,h]}} w[0] $wsiz is_window={*} fi
    stylize[0] .,${5-9},$15,$init_resolution,${17-26},$match_colors
    k[0,1] nm[0] $nm0
    if $is_window" && "!{*} break fi
  endl done
  rm. # Remove style image
  if 0$_output_mode
    if narg($ind_style) rm[$ind_style] fi # Do not duplicate style layer if output mode -> new layers
    if $is_window" && "!{*} rm fi # In case user closed the window, does not output new layers.
  fi

fx_stylize_preview :
  if $1<2 # Custom style (top or bottom layer)
    if $!<2 gui_warning_preview "At least two layers are required when specifying a custom style." return fi
    ind_first={$1==0?1:0} ind_style={$1==0?0:-1} N={$!-1} sh[$ind_style]
  else
    ind_first=0 N=$! ind_style= _fx_stylize {$1-2}
  fi
  repeat $N l[{$ind_first+$>},-1]
    gui_no_preview[0] ,
    +rr2d[1] {0,[w,h]*2/3},0,2 frame. 1,1,255 frame. 1,1,0,0,0,255 j[0] .,1%,30 rm. to[0] "Style:",1%,0,24
  endl done rm.
  if narg($ind_style) rm[$ind_style] fi

_fx_stylize : # Download pre-defined style image
  if isnum($1)
    name=${"arg 1+$1,landscapenearantwerp,leviaducalestaque,littlebayatlaciotat,themandola,windowsopensimultaneously,portraitdemetzinger,\
      greatwave,squareswithconcentriccircles,yellowredblue,deathandfire,inthestyleofkairouan,orientalpleasuregardenanagoria,\
      polyphony2,redwaistcoat,thekiss,\
      compositionredyellowblue,redtree,graytree,sangiorgiomaggioreatdusk,waterlilypond,\
      wheatstacksendofsummer,scream,udnie,lesdemoisellesdavignon,seatedwoman,reservoirhortadeebro,convergence,summertime9a,\
      almondblossom,irises,starrynight,wheatfieldwithcrows"}
  else name="$1"
  fi
  filename=${-path_cache}style_$name.png
  if isfile(['$filename']) $filename
  else i https://gmic.eu/img/style_$name.png o. $filename
  fi


bug0 :
  200,200,1,3
  sp lion,250 n. 0,1 r. 200,200,1,3,2
  eval "
    randomize(X,min,max) = (for (k = 0, k<size(X), ++k, X[k] = u(min,max)));
    randomize(X) = randomize(X,-1,1);

    sigma(x) = (x<0?0.1*x:x); # Activation function : Leaky RELU
    sigmap(x) = (x<0?0.1:1);

    vsigma(X) = ( unref(_tmp); _tmp = X; for (_k = 0, _k<size(X), ++_k, _tmp[_k] = sigma(_tmp[_k])); _tmp );
    vsigmap(X) = ( unref(_tmp); _tmp = X; for (_k = 0, _k<size(X), ++_k, _tmp[_k] = sigmap(_tmp[_k])); _tmp );

    const M = 2;
    const N1 = 10;
    const N2 = 20;
    const N3 = 40;
    const N4 = 160;
    const N5 = 40;
    const N6 = 20;
    const N7 = 10;
    const N8 = 3;

    X0 = vector(#M);

    W1 = dW1 = vector(#M*N1);
    B1 = dB1 = Z1 = X1 = vector(#N1);
    randomize(W1); randomize(B1);

    W2 = dW2 = vector(#N1*N2);
    B2 = dB2 = Z2 = X2 = vector(#N2);
    randomize(W2); randomize(B2);

    W3 = dW3 = vector(#N2*N3);
    B3 = dB3 = Z3 = X3 = vector(#N3);
    randomize(W3); randomize(B3);

    W4 = dW4 = vector(#N3*N4);
    B4 = dB4 = Z4 = X4 = vector(#N4);
    randomize(W4); randomize(B4);

    W5 = dW5 = vector(#N4*N5);
    B5 = dB5 = Z5 = X5 = vector(#N5);
    randomize(W5); randomize(B5);

    W6 = dW6 = vector(#N5*N6);
    B6 = dB6 = Z6 = X6 = vector(#N6);
    randomize(W6); randomize(B6);

    W7 = dW7 = vector(#N6*N7);
    B7 = dB7 = Z7 = X7 = vector(#N7);
    randomize(W7); randomize(B7);

    W8 = dW8 = vector(#N7*N8);
    B8 = dB8 = Z8 = X8 = vector(#N8);
    randomize(W8); randomize(B8);

    success = 0;
    frame = 1000;

    for (t = 0, t<inf, ++t,

      !(t%100)?print(t);
      success>=6?break();

      dW1 = 0; dB1 = 0;
      dW2 = 0; dB2 = 0;
      dW3 = 0; dB3 = 0;
      dW4 = 0; dB4 = 0;
      dW5 = 0; dB5 = 0;
      dW6 = 0; dB6 = 0;
      dW7 = 0; dB7 = 0;
      dW8 = 0; dB8 = 0;

      const K = 100;  # Number of mini-batches
      for (k = 0, k<K, ++k,

        a = u(0,1);
        b = u(0,1);
        X0 = [ a,b ];
        Y = I(#1,round([a,b]*w#1));

        # Forward pass.
        Z1 = mul(W1,X0,1) + B1;
        X1 = vsigma(Z1);
        Z2 = mul(W2,X1,1) + B2;
        X2 = vsigma(Z2);
        Z3 = mul(W3,X2,1) + B3;
        X3 = vsigma(Z3);
        Z4 = mul(W4,X3,1) + B4;
        X4 = vsigma(Z4);
        Z5 = mul(W5,X4,1) + B5;
        X5 = vsigma(Z5);
        Z6 = mul(W6,X5,1) + B6;
        X6 = vsigma(Z6);
        Z7 = mul(W7,X6,1) + B7;
        X7 = vsigma(Z7);
        Z8 = mul(W8,X7,1) + B8;
        X8 = vsigma(Z8);

        # Backward pass.
        dX8 = 2*(X8 - Y);
        dZ8 = dX8*vsigmap(Z8);
        dB8 += dZ8;
        dW8 += mul(dZ8,X7,size(X7));

        dZ7 = mul(transp(W8,N7),dZ8)*vsigmap(Z7);
        dB7 += dZ7;
        dW7 += mul(dZ7,X6,size(X6));

        dZ6 = mul(transp(W7,N6),dZ7)*vsigmap(Z6);
        dB6 += dZ6;
        dW6 += mul(dZ6,X5,size(X5));

        dZ5 = mul(transp(W6,N5),dZ6)*vsigmap(Z5);
        dB5 += dZ5;
        dW5 += mul(dZ5,X4,size(X4));

        dZ4 = mul(transp(W5,N4),dZ5)*vsigmap(Z4);
        dB4 += dZ4;
        dW4 += mul(dZ4,X3,size(X3));

        dZ3 = mul(transp(W4,N3),dZ4)*vsigmap(Z3);
        dB3 += dZ3;
        dW3 += mul(dZ3,X2,size(X2));

        dZ2 = mul(transp(W3,N2),dZ3)*vsigmap(Z2);
        dB2 += dZ2;
        dW2 += mul(dZ2,X1,size(X1));

        dZ1 = mul(transp(W2,N1),dZ2)*vsigmap(Z1);
        dB1 += dZ1;
        dW1 += mul(dZ1,X0,size(X0));

        # Test success.
        max(abs(X8 - Y))<1e-2?(
          ++success;
          success>=2?(
            print(X0,X8);
            print(success);

            # Draw 2d estimated function.
            for (b = 0, b<h#0, ++b,
              for (a = 0, a<w#0, ++a,
                X0 = [ a,b ]/w#0;
                Z1 = mul(W1,X0,1) + B1;
                X1 = vsigma(Z1);
                Z2 = mul(W2,X1,1) + B2;
                X2 = vsigma(Z2);
                Z3 = mul(W3,X2,1) + B3;
                X3 = vsigma(Z3);
                Z4 = mul(W4,X3,1) + B4;
                X4 = vsigma(Z4);
                Z5 = mul(W5,X4,1) + B5;
                X5 = vsigma(Z5);
                Z6 = mul(W6,X5,1) + B6;
                X6 = vsigma(Z6);
                Z7 = mul(W7,X6,1) + B7;
                X7 = vsigma(Z7);
                Z8 = mul(W8,X7,1) + B8;
                X8 = vsigma(Z8);
                I(#0,a,b) = X8;
              );
            );
            ext('*[0] 255 c[0] 0,255 if {*,u} w[0] -1,-1,0 fi o[0] frame_',frame,'.jpg,75');
            frame<5000?(++frame);
            print(save_frame=frame);
          );
        ):(success=0);

      );

      dW1/=K; dB1/=K;
      dW2/=K; dB2/=K;
      dW3/=K; dB3/=K;
      dW4/=K; dB4/=K;
      dW5/=K; dB5/=K;
      dW6/=K; dB6/=K;
      dW7/=K; dB7/=K;
      dW8/=K; dB8/=K;

      # Apply gradient descent.
      vmax = max(abs(dW1),abs(dB1),abs(dW2),abs(dB2),abs(dW3),abs(dB3),abs(dW4),abs(dB4),
                 abs(dW5),abs(dB5),abs(dW6),abs(dB6),abs(dW7),abs(dB7),abs(dW8),abs(dB8));
      eps = 0.01/vmax;
      W1 -= eps*dW1; B1 -= eps*dB1;
      W2 -= eps*dW2; B2 -= eps*dB2;
      W3 -= eps*dW3; B3 -= eps*dB3;
      W4 -= eps*dW4; B4 -= eps*dB4;
      W5 -= eps*dW5; B5 -= eps*dB5;
      W6 -= eps*dW6; B6 -= eps*dB6;
      W7 -= eps*dW7; B7 -= eps*dB7;
      W8 -= eps*dW8; B8 -= eps*dB8;

      # View network coefficients.
      # !(t%10000)?(
      #   ext('v - (',vtos(W1),') r. ',M,',',N1,',1,1,-1 w1. 200,300 rm.');
      #   ext('v - (',vtos(W2),') r. ',N1,',',N2,',1,1,-1 w2. 200,300 rm.');
      #   ext('v - (',vtos(W3),') r. ',N2,',',N3,',1,1,-1 w3. 200,300 rm.');
      #   ext('v - (',vtos(W4),') r. ',N3,',',N4,',1,1,-1 w4. 200,300 rm.');
      #   ext('v - (',vtos(W5),') r. ',N4,',',N5,',1,1,-1 w5. 200,300 rm.');
      #   ext('v - (',vtos(W6),') r. ',N5,',',N6,',1,1,-1 w6. 200,300 rm.');
      #   ext('v - (',vtos(W7),') r. ',N6,',',N7,',1,1,-1 w7. 200,300 rm.');
      #   ext('v - (',vtos(W8),') r. ',N7,',',N8,',1,1,-1 w8. 200,300 rm.');
      # );

    );"
  d[0]


bug :
  sp lena,64 luminance. n. 0,1
  7,7 rand. -1,1 # f. 0 =. 1,50%,50% =. 0.01,1,1

  +blur[0] 1,1,1 n. 0,1
#  +g[0] x n. 0,1
  nm X0,M,X1
  [0]

  eval "
    const boundary = 0;
    sigma(x) = (x<0?0.1*x:x); # Activation function : Leaky RELU
    sigmap(x) = (x<0?0.1:1);
    vsigma(X) = ( unref(_tmp); _tmp = X; for (_k = 0, _k<size(X), ++_k, _tmp[_k] = sigma(_tmp[_k])); _tmp );
    vsigmap(X) = ( unref(_tmp); _tmp = X; for (_k = 0, _k<size(X), ++_k, _tmp[_k] = sigmap(_tmp[_k])); _tmp );

    maxpool(X,wX,hX,dX,sX) = (
      unref(_tmp);
      const _mp_wX2 = max(1,int(wX/2));
      const _mp_hX2 = max(1,int(hX/2));
      const _mp_dX2 = max(1,int(dX/2));
      _tmp = vector(#_mp_wX2*_mp_hX2*_mp_dX2*sX);
      ext(wX,',',hX,',',dX,',',sX);
      copy(i(#l()-1),X,wX*hX*dX*sX);
      ext('maxpool.');
      copy(_tmp,i(#l()-1),_mp_wX2*_mp_hX2*_mp_dX2*sX);
      _tmp;
    );

    M1 = dM1 = crop(#1);
    Z1 = X1 = vector(#w#0*h#0);
    Y = crop(#2);

    MY = maxpool(Y,w#0,h#0,1,1);
    display(MY,int(w#0/2),int(h#0/2));

    delta = 0.001;

    for (t = 0, t<20000, ++t,

      I0 = crop(#0);

      # Forward pass.
      Z1 = correlate(I0,w#0,h#0,1,1,crop(#1),w#1,h#1,1,1);
      X1 = vsigma(Z1);

      # Backward pass.
      dX1 = 2*(X1 - Y);
      dZ1 = dX1*vsigmap(Z1);
      dM1 = correlate(I0,w#0,h#0,1,1,
                      dZ1,w#0,h#0,1,1,
                      1,0,1,
                      int(w#1/2),int(h#1/2),0,
                      0,0,0,
                      w#1-1,h#1-1,0);
      vmax = max(abs(dM1));
      eps = delta/vmax;

      M1 -= eps*dM1;
      draw(#1,M1,0,0,0,0,w#1,h#1);

      !(t%50)?(
        loss = norm(X1 - Y);
        print([loss,delta]);
        ext('v - w[1] 400,400');
        draw(#3,X1,0,0,0,0,w#0,h#0);
        ext('w1[3] 400,400');
      );

    );
  "

d

maxpool :
  +dilate. 2 r. 50%,50%,1,100%,1



# forward_fc : index
# Pre-requisites: images [fc$index] and [x{$index-1}] must be defined
# Output images [z$index] and [x$index]
forward_fc :
  +z[fc$1] {fc$1,[0,w-2]} mmul. [x{$1-1}]
  +columns[fc$1] 100%
  if {-2,w>1} r. {-2,w},100% fi
  +[-2,-1] +sigma. nm[-2,-1] z$1,x$1

# backward_fc : index
# Pre-requisites: images [x${index-1}], [fc$index], [dz$index] and [dfc$index] must be defined.
# Update [dfc$index] and output image [dz{$index-1}].
backward_fc :
  pi={$1-1}
  j[dfc$1] [dz$1],100%,0,0,0,-1 # Update bias
  +transpose[x$pi] +m*[dz$1] . j[dfc$1] .,0,0,0,0,-1 rm[-2,-1] # Update weights
  if narg(${z$pi}) # Propagate dz except for the first layer
    +z[fc$1] {fc$1,[0,w-2]} transpose. +m*. [dz$1]
    +sigma_der[z$pi] *[-2,-1] nm. dz$pi rm.. rv[dz$pi,dz$1]
  fi

# Activation function.
sigma :
  f "i<0?0.1*i:i" # Leaky RELU

sigma_der :
  f "i<0?0.1:1"

foo :

  v -

  sp lion,64 n. 0,1
  {2+1},10
  {h+1},20
  {h+1},40
  {h+1},80
  {h+1},40
  {h+1},20
  {h+1},10
  {h+1},3
  nm[-8--1] fc1,fc2,fc3,fc4,fc5,fc6,fc7,fc8
  rand[-8--1] -1,1

  [fc1,fc2,fc3,fc4,fc5,fc6,fc7,fc8] nm[-8--1] dfc1,dfc2,dfc3,dfc4,dfc5,dfc6,dfc7,dfc8

  repeat 100000,t
    N=100
    loss=0
    f[$dfc1-$dfc8] 0

    # Compute gradient of mini-batch.
    repeat $N
      coords={[u,u]}
      color={0,I(round([$coords]*[w#0-1,h#0-1]))}

      # Forward pass.
      ($coords) y. y nm. x0
      repeat 8 forward_fc {$>+1} done

      # Backward pass.
      if 0
      eval "
        sigma(x) = (x<0?0.1*x:x); # Activation function : Leaky RELU
        sigmap(x) = (x<0?0.1:1);
        vsigma(X) = ( unref(_tmp); _tmp = X; for (_k = 0, _k<size(X), ++_k, _tmp[_k] = sigma(_tmp[_k])); _tmp );
        vsigmap(X) = ( unref(_tmp); _tmp = X; for (_k = 0, _k<size(X), ++_k, _tmp[_k] = sigmap(_tmp[_k])); _tmp );

        W1 = crop(#"$fc1",0,w#"$fc1"-1);
        W2 = crop(#"$fc2",0,w#"$fc2"-1);
        W3 = crop(#"$fc3",0,w#"$fc3"-1);
        W4 = crop(#"$fc4",0,w#"$fc4"-1);
        W5 = crop(#"$fc5",0,w#"$fc5"-1);
        W6 = crop(#"$fc6",0,w#"$fc6"-1);
        W7 = crop(#"$fc7",0,w#"$fc7"-1);
        W8 = crop(#"$fc8",0,w#"$fc8"-1);

        X0 = crop(#"$x0");
        Z1 = crop(#"$z1"); X1 = crop(#"$x1");
        Z2 = crop(#"$z2"); X2 = crop(#"$x2");
        Z3 = crop(#"$z3"); X3 = crop(#"$x3");
        Z4 = crop(#"$z4"); X4 = crop(#"$x4");
        Z5 = crop(#"$z5"); X5 = crop(#"$x5");
        Z6 = crop(#"$z6"); X6 = crop(#"$x6");
        Z7 = crop(#"$z7"); X7 = crop(#"$x7");
        Z8 = crop(#"$z8"); X8 = crop(#"$x8");
        Y = [ "$color" ];

        dY = 2*(X8 - Y);
        dZ8 = dY*vsigmap(Z8);
        dW8 = mul(dZ8,X7,size(X7));
        dZ7 = mul(transp(W8,w#"$fc8"-1),dZ8)*vsigmap(Z7);
        dW7 = mul(dZ7,X6,size(X6));
        dZ6 = mul(transp(W7,w#"$fc7"-1),dZ7)*vsigmap(Z6);
        dW6 = mul(dZ6,X5,size(X5));
        dZ5 = mul(transp(W6,w#"$fc6"-1),dZ6)*vsigmap(Z5);
        dW5 = mul(dZ5,X4,size(X4));
        dZ4 = mul(transp(W5,w#"$fc5"-1),dZ5)*vsigmap(Z4);
        dW4 = mul(dZ4,X3,size(X3));
        dZ3 = mul(transp(W4,w#"$fc4"-1),dZ4)*vsigmap(Z3);
        dW3 = mul(dZ3,X2,size(X2));
        dZ2 = mul(transp(W3,w#"$fc3"-1),dZ3)*vsigmap(Z2);
        dW2 = mul(dZ2,X1,size(X1));
        dZ1 = mul(transp(W2,w#"$fc2"-1),dZ2)*vsigmap(Z1);
        dW1 = mul(dZ1,X0,size(X0));

        draw(#"$dfc1",dW1,0,0,0,0,w#"$dfc1"-1,h#"$dfc1",1,1,-1); draw(#"$dfc1",dZ1,w#"$dfc1"-1,0,0,0,1,h#"$dfc1",1,1,-1);
        draw(#"$dfc2",dW2,0,0,0,0,w#"$dfc2"-1,h#"$dfc2",1,1,-1); draw(#"$dfc2",dZ2,w#"$dfc2"-1,0,0,0,1,h#"$dfc2",1,1,-1);
        draw(#"$dfc3",dW3,0,0,0,0,w#"$dfc3"-1,h#"$dfc3",1,1,-1); draw(#"$dfc3",dZ3,w#"$dfc3"-1,0,0,0,1,h#"$dfc3",1,1,-1);
        draw(#"$dfc4",dW4,0,0,0,0,w#"$dfc4"-1,h#"$dfc4",1,1,-1); draw(#"$dfc4",dZ4,w#"$dfc4"-1,0,0,0,1,h#"$dfc4",1,1,-1);
        draw(#"$dfc5",dW5,0,0,0,0,w#"$dfc5"-1,h#"$dfc5",1,1,-1); draw(#"$dfc5",dZ5,w#"$dfc5"-1,0,0,0,1,h#"$dfc5",1,1,-1);
        draw(#"$dfc6",dW6,0,0,0,0,w#"$dfc6"-1,h#"$dfc6",1,1,-1); draw(#"$dfc6",dZ6,w#"$dfc6"-1,0,0,0,1,h#"$dfc6",1,1,-1);
        draw(#"$dfc7",dW7,0,0,0,0,w#"$dfc7"-1,h#"$dfc7",1,1,-1); draw(#"$dfc7",dZ7,w#"$dfc7"-1,0,0,0,1,h#"$dfc7",1,1,-1);
        draw(#"$dfc8",dW8,0,0,0,0,w#"$dfc8"-1,h#"$dfc8",1,1,-1); draw(#"$dfc8",dZ8,w#"$dfc8"-1,0,0,0,1,h#"$dfc8",1,1,-1);
      "

      else

      ($color) y. y nm. y
      -[x8,y] *[x8] 2 nm[x8] dx8
      +sigma_der[z8] *. [dx8] nm. dz8
      repeat 8 i={8-$>} backward_fc $i done

      fi

      rm[$x0--1]
    done

    # Gradient descent.
    vmax=0 repeat 8 vmax={dfc{1+$>},max($vmax,abs(im),abs(iM))} done
    eps={0.01/$vmax}
    *[$dfc1-$dfc8] $eps
    repeat 8 i={$>+1} -[fc$i] [dfc$i] done

    # Show full reconstruction result.
    if !($t%1)
      [0],[0],1,2,[x,y]/[w#0-1,h#0-1] r. {w*h},2,1,1,-1 nm. x0
      repeat 8 forward_fc {1+$>} rm[x{$>},z{1+$>}] done
      r. [0],[0],1,3,-1

      +-. [0] loss={norm(crop())} rm.
      v + e "LOSS = "$loss v -
      w. -1,-1,"Reconstruction" rm.
      w2[0] -1,-1,"Reference"

    fi

  done

_fx_stylize_ :
  m _b:base642img\ $""1 m _r:run\ \{t\}\ rm _b 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 _r. uncommand _b,_r
